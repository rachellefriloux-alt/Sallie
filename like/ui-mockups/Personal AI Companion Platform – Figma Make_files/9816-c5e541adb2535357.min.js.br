"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="55607d9a-c14e-5ebb-bef3-6c06e3ff44a2")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[9816],{476445:(e,t,r)=>{r.d(t,{c:()=>d});var s=r(278995),a=r(536760),i=r(355448),n=r(230111),o=r(187891),l=r(258566);async function d(e={}){let{blockOnJoin:t=!1,joinTimeoutMs:r=5e3}=e;if(t&&!(0,l.eN)()){let e=performance.now(),t=Symbol("timeout"),a=(0,l.oJ)(s.kul.JOINED),n=new Promise(e=>setTimeout(()=>e(t),r)),o=await Promise.race([a,n]),d=performance.now()-e,c=o===t;if((0,i.rI)([{metric:"web.multiplayer.flush.wait_for_joined_state.duration_ms",value:d,tags:{success:c?"false":"true"}}]),c)throw Error(`Timeout waiting for multiplayer state JOINED after ${r}ms`)}return await (0,l.u3)(),s.h3O?.flush(),await (0,o.l)(),a.zl.get(n.J)}},720095:(e,t,r)=>{r.d(t,{Z:()=>o});var s=r(449980),a=r(693181),i=r(605400);let n=s.z.object({js_url:s.z.string(),css_url:s.z.string()}),o=new class{constructor(){this.GetCachedPreviewUrlsValidator=(0,a.YV)("GetCachedPreviewUrlsValidator",(0,i.D)(n),null)}getCachedPreviewUrls(e){return this.GetCachedPreviewUrlsValidator.validate(async({xr:t})=>await t.get(`/api/make/${e.fileKey}/cached_preview_urls`,{source_code_hash:e.sourceCodeHash}))}}},360393:(e,t,r)=>{r.d(t,{e:()=>s});let s="https://go/figmascope-docs"},516980:(e,t,r)=>{r.d(t,{rf:()=>n,tV:()=>o,zG:()=>i});var s=r(104076),a=r(626660);function i(){return(0,s.jsx)(o,{children:(0,s.jsx)("p",{children:"Reading file..."})})}function n({error:e}){let t="Oops! Something went wrong";return"string"==typeof e?t=e:e instanceof Error&&(t=e.message,console.error(e)),(0,s.jsx)(o,{children:(0,s.jsx)("p",{style:a.sx.colorTextOndanger.colorBgDanger.p16.font20.maxW400.$,children:t})})}function o({children:e}){return(0,s.jsx)("div",{style:a.sx.fillPositionedContainer.flex.itemsCenter.justifyCenter.flexColumn.lh1_5Lines.font16.$,children:e})}},640333:(e,t,r)=>{r.d(t,{J:()=>tg});var s=r(104076),a=r(716976),i=r(784592),n=r(536760),o=r(59881),l=r(11112),d=r(128212),c=r(509233),u=r(626660),h=r(671265),p=r(49686),f=r(618949),m=r(56857),g=r(225443),y=r(906657),b=r(90482),_=(e=>(e[e.Fetched=0]="Fetched",e[e.Fetching=1]="Fetching",e[e.NeverFetched=2]="NeverFetched",e))(_||{});let v=(0,n.eU)(e=>{let t=e(g.OC);return"fullscreen"===t.view?`/api/file/scenegraph_validations/${t.fileKey}`:(0,y.E)(t)&&t.urlParams?.type==="server_file"?`/api/admin/scenegraph_validations/${t.urlParams.key}`:null}),S=(0,n.eU)(e=>null!=e(v)),x=(()=>{let e=(0,n.eU)((0,f.Ok)());return(0,n.eU)(t=>t(e),async(t,r)=>{let s;if(t(e).status===c.r.LOADING)return;let a=t(v);if(a){r(e,(0,f.ux)());try{s=await w(a)}catch(t){r(e,(0,f.uW)(t));return}r(e,(0,f.NY)(s))}})})();async function w(e){let t=await (0,m.GD)(e),r=new b._;for(let e of t.data.meta.data.results.violations)if("always-fail-for-testing"!==e.name)for(let t of e.instances)r.add(t.guid,t.message);return r}var k=r(247234),C=r(465847),I=r(516980),T=r(255054),E=r(285017),j=r(47890),N=r(278995),A=r(267021),R=r(957501),M=r.n(R),U=r(213242),F=r(256112),D=r(167993);let O=(0,C.Sv)("bookmarkSettings",{bookmarks:{}}),P=(0,n.eU)(e=>{let t=e(O),r=e(p.Cc).id;return new Set((t.bookmarks[r]??[]).map(e=>e.id))});function L(){let[e,t]=(0,n.fp)(O),r=(0,n.md)(p.Cc).id,s=a.useCallback(s=>{t({...e,bookmarks:{...e.bookmarks,[r]:s(e.bookmarks[r]||[])}})},[e,r,t]),i=a.useCallback((e,t)=>{s(r=>[...r,{id:e,name:t}])},[s]),o=a.useCallback(e=>{s(t=>t.filter((t,r)=>r!==e))},[s]),l=a.useCallback((e,t)=>{s(r=>r.map((r,s)=>s===e?{...r,name:t}:r))},[s]),d=a.useCallback((e,t)=>{s(r=>r.map((r,s)=>s===e?{...r,id:D.SW.fromString(t)}:r))},[s]);return{addBookmark:i,deleteBookmark:o,moveBookmarkDown:a.useCallback(e=>{s(t=>{if(e>=t.length-1)return t;let r=t.slice(),[s]=r.splice(e,1);return r.splice(e+1,0,s),r})},[s]),moveBookmarkUp:a.useCallback(e=>{s(t=>{if(e<=0)return t;let r=t.slice(),[s]=r.splice(e,1);return r.splice(e-1,0,s),r})},[s]),renameBookmark:l,updateBookmarkId:d,bookmarks:a.useMemo(()=>e.bookmarks[r]||[],[e,r])}}var z=r(760267);function H(e,t,r){return[...e.getObject(r)?.mapDescendants(e=>e.id)??[],...t?.getObject(r)?.mapDescendants(e=>e.id)??[]]}let B=(0,n.FZ)((0,n.eU)({}),(e,t,r)=>{let s=r(p.Cc),a=r(p.lX);switch(t.type){case"toggleExpanded":return(0,z.X9)(e,t.objectId,t.toggleSubtree?H(s,a,t.objectId):[]);case"expandAncestors":return(0,z.nE)(e,function(e,t,r){return[...e.getObject(r)?.mapAncestors(e=>e.id)??[],...t?.getObject(r)?.mapAncestors(e=>e.id)??[]]}(s,a,t.objectId),!0);case"expandDescendants":return(0,z.nE)(e,[t.objectId,...H(s,a,t.objectId)],!0);case"collapseDescendants":return(0,z.IO)(e,[t.objectId,...H(s,a,t.objectId)])}});var $=r(932732),K=r(122864),V=r(584019);let q=(0,n.eU)({status:"initial"}),G=(0,n.eU)(0),Y=(0,n.eU)(!1),X=(0,n.eU)(e=>{if(e(Y)){let t=e(G);return`Indexing search results (this may take a moment)... [${t}/???]`}return null}),J=(0,C.Sv)("searchMode",C.Y6.Search),W=(0,n.eU)(e=>{let t=e(q),r=e(p.Cc),s=e(k.Sd);return"initial"===t.status?s.map(e=>r.getObject(e)).filter(K.Vq).map(e=>({object:e,matches:[]})).reverse():"results"in t&&t.results.length>0?t.results:null}),Q=(0,n.eU)(e=>{let t=e(q);if("searching"===t.status&&0===t.results.length){let t=["Searching..."],r=e(X);return r&&t.push(r),t}if("success"===t.status&&0===t.results.length){let t=["No results found."],r=e(p.Cc);return r instanceof V.G2&&t.push("Some content may be unavailable because of incremental loading"),"hide"===r.sensitiveTextPolicy&&t.push("Searching text fields is limited beacuse text redaction has been applied."),t}return"error"===t.status?["Error searching:",String(t.error)]:null}),Z=(0,n.eU)(e=>{if(e(J)!==C.Y6.Filter)return null;let t=e(q);return"results"in t?t.results.map(e=>e.object):null}),ee=(0,n.eU)(e=>{if(e(J)!==C.Y6.Filter)return null;let t=e(Q);return t?t.join(" "):null}),et=(0,C.Sv)("sortOrder",C.hX.Position),er=(0,n.eU)(e=>{let t=[C.hX.Position,C.hX.Name,C.hX.NodeId];return e(p.Cc).rootObjects[0]?.displayProperties.memoryFraction!=null&&t.push(C.hX.Memory),t.sort(),t}),es=(0,n.eU)(e=>{switch(e(et)){case C.hX.Position:return ei;case C.hX.Name:return ea;case C.hX.Memory:return eo;case C.hX.NodeId:return en}});function ea(e,t){return e.displayProperties.name.localeCompare(t.displayProperties.name)}function ei(e,t){let[r,s]=el(e,t);if(r&&s){let e=r.parentIndex?.position,t=s.parentIndex?.position;if(null==e&&null==t)return 0;if(null==t)return 1;if(null==e)return -1;if(e<t)return -1;else if(e>t)return 1}return ea(e,t)}function en(e,t){let[r,s]=el(e,t);if(r&&s){let{sessionID:e,localID:t}=r.guid??{localID:-1,sessionID:-1},{sessionID:a,localID:i}=s.guid??{localID:-1,sessionID:-1};return e-a||t-i}return ei(e,t)}function eo(e,t){return(t.displayProperties.memoryFraction??0)-(e.displayProperties.memoryFraction??0)||ei(e,t)}function el(e,t){return"nodeChange"in e&&"nodeChange"in t?[e.nodeChange,t.nodeChange]:[null,null]}var ed=r(570179),ec=r(478384),eu=r(468882),eh=r(345840),ep=r(251931),ef=r(359026),em=r(467307);let eg=ep.ms,ey=ep.c$,eb=ep.wv;function e_({contextMenuData:{objectId:e,position:t},onClose:r}){let[i,o]=a.useState(0),l=t.left,d=t.top+i>window.innerHeight?t.top-i:t.top,{canSelectInApp:c,selectInApp:f}=a.useContext(k.H$),m=a.useRef(null);(0,eh.ww)(m,r);let g=(0,n.md)(p.Cc).getObject(e),y=g instanceof em.R?g:null,b=g instanceof ef.E?g:null,[_,v]=(0,n.fp)(h.Oz),S=(0,n.Xr)(B);if(null==g)return null;let x=e=>()=>{e(),r()},w=g.children.length>0,C=(()=>{if(c?.(g))return x(()=>f(g))})(),I=e=>x(()=>N.glU?.triggerAction(e,{guid:g.id})),T=_?.object.id===g.id;return(0,s.jsx)(eg,{style:{...u.sx.fixed.$,left:l,top:d},dropdownRef:e=>{e&&o(e.clientHeight)},children:(0,s.jsxs)("div",{ref:m,children:[C&&(0,s.jsx)(ey,{onClick:C,children:"Jump to node"}),w&&(0,s.jsx)(ey,{onClick:x(()=>S({type:"expandDescendants",objectId:e})),children:"Expand descendants"}),w&&(0,s.jsx)(ey,{onClick:x(()=>S({type:"collapseDescendants",objectId:e})),children:"Collapse descendants"}),(C||w)&&(0,s.jsx)(eb,{}),T&&(0,s.jsx)(ey,{onClick:x(()=>v({type:"clear"})),children:"Stop diffing against this node"}),(!T||_?.type!==h.Lp.Layer)&&(0,s.jsx)(ey,{onClick:x(()=>v({type:"start",diffType:h.Lp.Layer,id:e})),children:"Layer diff against this node"}),(!T||_?.type!==h.Lp.Tree)&&(0,s.jsx)(ey,{onClick:x(()=>v({type:"start",diffType:h.Lp.Tree,id:e})),children:"Tree diff against this node"}),y&&(0,s.jsx)(eb,{}),y&&(0,s.jsx)(ey,{onClick:x(()=>{let e=JSON.stringify(y.nodeChange,null,2);navigator.clipboard.writeText(e)}),children:"Copy NodeChange JSON"}),b&&"DOCUMENT"!==b.type&&"CANVAS"!==b.type&&(0,s.jsx)(ey,{onClick:I("debug-print-as-test-code"),children:(0,eu.tx)("fullscreen_actions.debug-print-as-test-code")}),b&&"VECTOR"===b.type&&(0,s.jsx)(ey,{onClick:I("debug-print-vector-network-as-test-code"),children:(0,eu.tx)("fullscreen_actions.debug-print-vector-network-as-test-code")})]})})}var ev=r(454292);let eS=a.memo(function({diffType:e,id:t,primaryId:r,secondaryId:i,leftBadges:n,indent:o,index:l,isExpanded:d,isLeaf:c,isSelected:u,isSelectedSecondary:h,memoryFraction:p,rightBadges:f,name:m,style:g,select:y,toggle:b,showContextMenu:_}){let v=a.useCallback(e=>{e.preventDefault(),_({objectId:t,position:{left:e.clientX,top:e.clientY}})},[t,_]);return(0,s.jsxs)(ev.Z,{changeType:e,indent:o,isExpanded:d,isLeaf:c,isSelected:u,isSelectedSecondary:h,keyboardNavigationPath:[l],onContextMenu:v,onMouseEnter:()=>{N.Ez5&&N.Ez5.editorState().figmaScopeHighlightedNode.set(t)},onMouseLeave:()=>{N.Ez5&&N.Ez5.editorState().figmaScopeHighlightedNode.set("")},select:()=>y(t),style:g,toggleExpanded:e=>b(t,e),children:[(0,s.jsx)(ed.IV,{badges:n}),(0,s.jsx)(ec.nK,{id:r}),i&&(0,s.jsx)(ec.nK,{id:i,secondary:!0}),(0,s.jsx)("div",{title:m,className:U.s.ellipsis.noWrap.overflowHidden.$,children:m}),(0,s.jsx)(F.M,{}),(0,s.jsx)(ed.IV,{badges:f}),null!=p&&(0,s.jsxs)("span",{className:U.s.colorTextSecondary.$,title:"Node memory usage",children:[(100*p).toFixed(3),"%"]})]})});function ex({style:e,data:{displayedObjects:t,selectedId:r,selectedIds:a,...i},index:n}){let o=t[n],l=(0,A.zN)(e);return(0,s.jsx)(eS,{...o,...i,isSelected:r===o.id,isSelectedSecondary:!!o&&a.includes(o.id),style:l,index:n})}let ew=[];function ek({appSelection:e}){let t=(0,n.md)(eC),[r,i]=(0,n.fp)(k.AJ),o=(0,A.k9)(()=>e?.guids??ew,[e?.guids]),[l,d]=a.useState(null),c=a.useRef(null);a.useEffect(()=>{let e=t.findIndex(e=>e.id===r);e>=0&&c.current?.scrollToItem(e,"smart")},[t,r]);let u=(0,n.Xr)(B);a.useEffect(()=>{u({type:"expandAncestors",objectId:r})},[u,r]);let h=a.useCallback((e,t)=>{u({type:"toggleExpanded",objectId:e,toggleSubtree:t})},[u]),p=(0,n.md)(ee);return 0===t.length?(0,s.jsx)("div",{children:p??"Empty Scene"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.A,{disableWidth:!0,children:({height:e})=>(0,s.jsx)(E.Y1,{itemSize:18,itemCount:t.length,height:e,ref:c,itemData:{displayedObjects:t,selectedId:r,selectedIds:o,select:i,toggle:h,showContextMenu:d},width:"100%",children:ex})}),l&&(0,s.jsx)(e_,{contextMenuData:l,onClose:()=>{d(null)}})]})}let eC=(0,n.eU)(e=>{let t=e(P),r=e(p.Cc);return(e(eI)??e(eT)).map(e=>({...e,rightBadges:[...e.rightBadges,...t.has(e.id)?[{type:"bookmark",value:"Bookmarked"}]:[],...r.getAdditionalBadges?.(e.id)||[]]}))}),eI=(0,n.eU)(e=>{let t=e(Z);return t?t.map(e=>({...e.displayProperties,diffType:void 0,id:e.id,indent:0,isExpanded:!1,isLeaf:!0})):null}),eT=(0,n.eU)(e=>{let t=e(p.Cc).rootObjects,r=e(h.sg),s=e(B),a=e(es),i=(()=>{switch(r.type){case h.Lp.Tree:return[r.object];case h.Lp.Full:return r.resource.rootObjects;default:return[]}})(),n={sortFn:a,expandedIds:s};return M()(t,e=>{if(!e)return[];if(0===i.length)return eE(e,0,n);let t=eN(e,i);return t?ej(e,t,0,n):function e(t,r,s,a){let i=t.id,n=t.children,o=0===n.length,l=!!a.expandedIds[i],d=!1,c=M()(n,t=>{let i=(()=>{let i=eN(t,r);if(i)return ej(t,i,s+1,a);let n=r.filter(e=>e.someAncestor(e=>e.id===t.id,{includeSelf:!0}));return n.length>0?e(t,n,s+1,a):eE(t,s+1,a)})();return d=d||i[0]?.diffType!=null,i}),u={...t.displayProperties,diffType:d?"CHILD_MODIFIED":void 0,id:i,indent:s,isExpanded:l,isLeaf:o};return l?[u,...c]:[u]}(e,i,0,n)})});function eE(e,t,r){let s=e.id,a=e.children,i=0===a.length,n=!!r.expandedIds[s],o={...e.displayProperties,diffType:void 0,id:s,indent:t,isExpanded:n,isLeaf:i};return n?[o,...M()(eA(a,r.sortFn),e=>eE(e,t+1,r))]:[o]}function ej(e,t,r,s){let a=e??t;if(!a)throw Error("Diffing two nothings");if(e&&t&&e.id!==t.id)throw Error("Diffing nodes with mismatched keys");let i=a.id,n=eA(e?.children??[],s.sortFn),o=eA(t?.children??[],s.sortFn),l=(0,j.TR)(n,o,e=>e.id),d=!1,c=M()(l,({left:e,right:t})=>{let a=ej(e,t,r+1,s);return d=d||a[0]?.diffType!=null,a}),u=(0,h.wc)(e,t,d),p=e?.displayProperties.name,f=t?.displayProperties.name,m=null!=p&&null!=f&&p!==f?`${p} <=> ${f}`:a.displayProperties.name,g=!!s.expandedIds[i],y={...a.displayProperties,diffType:u,id:i,indent:r,isExpanded:g,isLeaf:0===l.length,name:m};return g?[y,...c]:[y]}function eN(e,t){return t.find(t=>t.id===e.id)}function eA(e,t){return e.slice().sort(t)}var eR=r(748716),eM=r(289157),eU=r(629864);r(224433);var eF=r(854459),eD=r(498020),eO=r(542446),eP=r(687183),eL=r(823762),ez=r(468253),eH=r(738940),eB=r(489557),e$=r(588863),eK=r(955262);function eV(e){let{bookmarks:t,deleteBookmark:r,moveBookmarkDown:i,moveBookmarkUp:n,renameBookmark:o,updateBookmarkId:l}=L();return(0,s.jsx)(eF.bL,{defaultPosition:{x:window.innerWidth/2,y:window.innerHeight/2},onClose:e.onClose,width:400,children:(0,s.jsxs)(eD.vo,{children:[(0,s.jsx)(eD.Y9,{children:(0,s.jsx)(eD.hE,{children:"FigmaScope Bookmarks"})}),(0,s.jsx)(eD.nB,{children:(0,s.jsxs)(eO.bL,{className:"xrvj5dj x1nfngrj",children:[0===t.length&&(0,s.jsx)("div",{className:"x6s0dn4 x78zum5 xpyat2d xl56j7k",children:"No bookmarks"}),t.length>0&&(0,s.jsxs)(eP.fI,{className:"xrvj5dj xuhvigx xg2d0mh",children:[(0,s.jsx)(eL.fh,{children:"Name"}),(0,s.jsx)(eL.fh,{children:"ID"})]}),t.map((e,d)=>(0,a.createElement)(eP.fI,{className:"xrvj5dj xuhvigx xg2d0mh",key:d},(0,s.jsx)(eL.fh,{children:(0,s.jsx)(ez.p,{id:`edit-bookmark-name-${d}`,value:e.name,onChange:e=>o(d,e)})}),(0,s.jsx)(eL.fh,{children:(0,s.jsx)(ez.p,{id:`edit-bookmark-id-${d}`,value:e.id,onChange:e=>l(d,e)})}),(0,s.jsx)(eL.fh,{children:(0,s.jsxs)(eH.e,{"aria-label":`Bookmark actions for ${e.name}`,children:[(0,s.jsx)(eM.K,{"aria-label":"Delete bookmark",onClick:()=>r(d),children:(0,s.jsx)(eB.i,{})}),(0,s.jsx)(eM.K,{"aria-label":"Move bookmark up",disabled:0===d,onClick:()=>n(d),children:(0,s.jsx)(e$.t,{})}),(0,s.jsx)(eM.K,{"aria-label":"Move bookmark down",disabled:d===t.length-1,onClick:()=>i(d),children:(0,s.jsx)(eK.O,{})})]})})))]})})]})})}function eq(){let[e,t]=(0,n.fp)(k.AJ),r=(0,n.md)(k.gg),{getTriggerProps:i,manager:o}=eR.b(),{addBookmark:l,bookmarks:d}=L(),[c,u]=a.useState(!1);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(eR.bL,{manager:o,children:[(0,s.jsx)("div",{className:"xrybvsa",children:(0,s.jsx)(eM.K,{...i(),"aria-label":"bookmarks",children:(0,s.jsx)(eU.j,{})})}),(0,s.jsxs)(eR.mc,{children:[(0,s.jsxs)(eR.YJ,{title:(0,s.jsx)(eR.r1,{children:"Bookmark settings"}),children:[(0,s.jsx)(eR.q7,{onClick:()=>{let t=r?.displayProperties.name??"Bookmark";l(e,`${t} - ${e}`)},children:"Add bookmark"}),(0,s.jsx)(eR.q7,{onClick:()=>{u(!0)},children:"Manage bookmarks"})]}),d.length?(0,s.jsx)(eR.YJ,{title:(0,s.jsx)(eR.r1,{children:"Bookmark list"}),children:d.map((e,r)=>(0,s.jsx)(eR.q7,{onClick:()=>{t(e.id)},children:e.name},r))}):null]})]}),c&&(0,s.jsx)(eV,{onClose:()=>u(!1)})]})}var eG=r(511570),eY=r.n(eG),eX=r(839591),eJ=r(125239);function eW({searchRef:e}){let t=(0,n.Xr)(k.AJ),r=(0,n.md)(W),i=(0,n.md)(Q),[o,l]=a.useState(!1),d=(0,n.md)(J)!==C.Y6.Filter&&o,c=a.useRef(null);(0,eh.ww)(c,()=>l(!1));let u=a.useCallback(e=>{l(!1),t(e.object.id)},[l,t]);return(0,s.jsxs)(eJ.dP,{className:U.s.flex1.$,ref:c,allowVim:!0,children:[(0,s.jsx)(eQ,{searchRef:e,setShowSearchResults:l}),d&&(r?(0,s.jsx)(e0,{searchResults:r,selectResult:u}):i?(0,s.jsx)(e1,{text:i}):null)]})}function eQ({searchRef:e,setShowSearchResults:t}){let r=(0,n.md)(J),i=function(){let e=(0,n.md)(p.Cc),t=(0,n.Xr)(q),r=(0,n.Xr)(G),s=(0,n.Xr)(Y),i=a.useRef(0),o=a.useMemo(()=>(0,$.s)(a=>{let n=++i.current;s(!0);let o=new TaskController({priority:"user-visible"});scheduler.postTask(()=>s(!0),{signal:o.signal,delay:300}).catch(()=>{});let l=e.getObject(a);l&&t({status:"searching",results:[{object:l,matches:[{value:a,property:"id",isExact:!0}]}]}),e.getSearch(r).then(e=>e.searchWithText(a)).then(e=>{o.abort(),n===i.current&&t({status:"success",results:e})}).catch(e=>{console.error(e),o.abort(),n===i.current&&t({status:"error",error:e})})},200),[e,r,t,s]);return a.useCallback(e=>0===e.length?t({status:"initial"}):o(e),[o,t])}(),{setKeyboardNavigationElement:o}=(0,eJ.M3)({path:[0,0],id:"input"});return(0,s.jsx)("input",{ref:t=>{o(t),e.current=t},type:"text",placeholder:r,className:"search_bar--searchBar--qnpUm",onChange:e=>i(e.target.value),onFocus:()=>t(!0)})}function eZ({children:e}){return(0,s.jsx)("div",{className:U.s.absolute.zIndexModal.colorBg.b1.colorBorder.mt2.overflowAuto.$,style:{maxHeight:450,minWidth:500,boxShadow:"0px 2px 14px var(--color-shadow, rgba(0, 0, 0, 0.15))"},children:e})}function e0({searchResults:e,selectResult:t}){return(0,s.jsx)(eZ,{children:e.map((e,r)=>(0,s.jsx)(e4,{result:e,index:r,onClick:()=>t(e)},e.object.id))})}function e1({text:e}){return(0,s.jsx)(eZ,{children:(Array.isArray(e)?e:[e]).map((e,t)=>(0,s.jsx)("div",{className:U.s.colorBg.colorTextSecondary.px8.py4.$,children:e},t))})}function e4({result:e,index:t,onClick:r}){let{object:i,matches:n}=e,{displayProperties:o}=i,{setKeyboardNavigationElement:l,keyboardNavigationItem:d,isFauxFocused:c}=(0,eJ.M3)({path:[1,t],id:i.id});return a.useEffect(()=>{d&&0===t&&d.fauxFocus()},[d,t]),(0,s.jsx)("button",{ref:l,className:eY()(U.s.block.wFull.px4.py8.colorText.flex.itemsCenter.alignLeft.$,"search_bar--searchResult--0iOvc",c&&"search_bar--fauxFocus--BYHwu"),onClick:r,children:(0,s.jsxs)(F.Y,{spacing:4,children:[(0,s.jsx)(ed.IV,{badges:o.leftBadges}),(0,s.jsx)(ec.nK,{id:i.displayProperties.primaryId}),(0,s.jsx)(eX.R,{className:U.s.overflowHidden.$,text:o.name}),(0,s.jsx)(F.M,{}),n.filter(({property:e})=>!["id","guid","name","type","phase"].includes(e)).map(({property:e,value:t},r)=>(0,s.jsxs)(F.Y,{spacing:4,width:"hug-contents",children:[(0,s.jsxs)("div",{children:[e,":"]}),(0,s.jsx)("div",{children:t})]},r))]})})}var e3=r(927903);function e2({children:e}){return(0,s.jsx)("div",{className:U.s.colorBorder.px8.py4.bb1.bSolid.$,children:(0,s.jsx)(F.Y,{children:e})})}function e6(e){let t={className:"toolbar_components--iconButton--1-XNe",children:(0,s.jsx)(e3.B,{svg:e.svg}),title:e.label,"aria-label":e.label};return"href"in e?(0,s.jsx)("a",{...t,href:e.href,target:"blank"}):(0,s.jsx)("button",{...t,onClick:e.onClick,disabled:e.disabled})}var e9=r(129503),e5=r(496287);function e7({searchRef:e}){let[t,r]=(0,n.fp)(k.jI),[i,l]=(0,n.fp)(k.JN),d=!!a.useContext(k.H$).selectInApp,[c,u]=(0,n.fp)(J),[h,p]=(0,n.fp)(k.bA),[f,m]=(0,n.fp)(et),g=(0,n.md)(er);return(0,s.jsxs)(e2,{children:[(0,s.jsx)(eW,{searchRef:e}),(0,s.jsxs)("select",{name:"filter-or-search",title:"Determines whether the text box searches or filters",onChange:e=>{u(e.target.value)},defaultValue:c,children:[(0,s.jsx)("option",{value:C.Y6.Search,children:"Search"}),(0,s.jsx)("option",{value:C.Y6.Filter,children:"Filter"})]}),(0,s.jsx)("select",{name:"sort",title:"Sets the left panel sort order",onChange:e=>{let t=e.target.value;o.az.trackDefinedEvent("figmascope.sort_order_change",{order:function(e){switch(e){case C.hX.Position:return"position";case C.hX.Name:return"name";case C.hX.Memory:return"memory";case C.hX.NodeId:return"node_id"}}(t)}),m(t)},defaultValue:f,children:g.map(e=>(0,s.jsxs)("option",{value:e,children:["Sort by ",e]},e))}),d&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{name:"follow-selection",type:"checkbox",checked:h,onChange:e=>p(e.target.checked)}),(0,s.jsx)("label",{htmlFor:"follow-selection",children:"Follow"})]}),(0,s.jsx)(e6,{label:"Select Previous",onClick:()=>{r(),o.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"prev",source:"button"})},disabled:!t,svg:e9.A}),(0,s.jsx)(e6,{label:"Select Next",onClick:()=>{l(),o.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"next",source:"button"})},disabled:!i,svg:e5.A}),(0,s.jsx)(eq,{})]})}var e8=r(664463),te=r(250116),tt=r(872935),tr=r(360393),ts=r(380980),ta=r(458609),ti=r(619883),tn=r(821527);function to({selectedObject:e,diffObject:t,onClose:r}){let a=(0,n.md)(S),[i,o]=(0,n.fp)(h.Oz);return(0,s.jsxs)(e2,{children:[e?i&&t?(0,s.jsx)(tc,{selectedObject:e,diffObject:t,diffState:i,setDiffState:o}):(0,s.jsx)(td,{object:e}):t?(0,s.jsx)(td,{object:t}):(0,s.jsx)(F.M,{}),a&&(0,s.jsx)(tu,{}),(0,s.jsx)(e6,{label:"Help",href:tr.e,svg:ts.A}),r&&(0,s.jsx)(e6,{label:"Close FigmaScope",onClick:r,svg:tn.A})]})}let tl=U.s.flex1.ml10.my4.$;function td({object:e}){return(0,s.jsx)("div",{className:tl,children:(0,s.jsx)("span",{className:U.s.fontSemiBold.$,children:e.displayProperties.longName})})}function tc({selectedObject:e,diffObject:t,diffState:r,setDiffState:a}){let i=(0,n.Xr)(k.AJ);return(0,s.jsxs)("div",{className:U.s.flex1.ml10.my4.$,children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:U.s.colorTextSecondary.$,children:"Diffing "}),(0,s.jsx)("span",{className:U.s.fontSemiBold.$,children:e.displayProperties.longName}),(0,s.jsx)("span",{className:U.s.colorTextSecondary.$,children:" against "}),(0,s.jsx)("span",{className:U.s.fontSemiBold.$,children:t.displayProperties.longName})]}),r&&(0,s.jsx)("div",{className:U.s.colorTextSecondary.mt8.$,children:(0,s.jsxs)(F.Y,{spacing:8,width:"hug-contents",height:"hug-contents",verticalAlignItems:"start",children:[(0,s.jsxs)("span",{children:["Snapshot of"," ",(0,s.jsx)(tt.CY,{onClick:()=>i(r.object.id),className:U.s.colorTextFigjam.fontSemiBold.$,trusted:!0,children:r.object.displayProperties.name}),r.type===h.Lp.Tree&&" and full subtree"," was taken at"," ",r.time.toLocaleTimeString("en-US")]}),(0,s.jsx)(tt.CY,{onClick:()=>a({type:"refresh"}),className:U.s.colorTextDesign.$,trusted:!0,children:"Refresh"}),(0,s.jsx)(tt.CY,{onClick:()=>a({type:"clear"}),className:U.s.colorTextDanger.$,trusted:!0,children:"Finish"})]})})]})}function tu(){let[e,t]=(0,n.fp)(x),r=e.status===c.r.LOADING;return a.useEffect(()=>{t()},[t]),(0,s.jsx)(e6,{label:r?"Fetching scene graph validation failures":"Refetch scenegraph validation failures",onClick:t,svg:r?ta.A:ti.A})}var th=r(420398);function tp({children:e}){return(0,s.jsx)("div",{className:U.s.hFull.$,children:(0,s.jsxs)(F.Y,{direction:"vertical",width:"fill-parent",height:"fill-parent",padding:0,spacing:0,children:[(0,s.jsx)(tf,{}),e]})})}function tf(){let{name:e,metadata:t}=(0,n.md)(p.Cc);return(0,s.jsxs)(F.Y,{direction:"horizontal",width:"fill-parent",height:32,padding:8,spacing:32,backgroundColor:"toolbar",children:[e&&(0,s.jsx)(th.E,{fontWeight:"bold",color:"toolbar",children:e}),t&&Object.entries(t).map(([e,t])=>t&&(0,s.jsxs)("span",{children:[(0,s.jsxs)(th.E,{color:"toolbar-secondary",children:[e,": "]}),(0,s.jsx)(th.E,{color:"toolbar",fontFamily:"monospace",fontWeight:"bold",children:t})]},e))]})}var tm=r(753639);let tg=a.memo(function({embedded:e=!1,emptyStateContent:t,onClose:r,appSelection:a,setAppSelection:i}){let o=(0,n.md)(p.lu);switch(o.status){case c.r.INIT:return t??(0,s.jsx)(I.zG,{});case c.r.LOADING:return(0,s.jsx)(I.zG,{});case c.r.FAILURE:return(0,s.jsx)(I.rf,{error:o.error});case c.r.SUCCESS:}if(0===o.value.primaryResource.rootObjects.length)return(0,s.jsx)(I.rf,{error:"No root objects found. This is likely a bug - please report in #figmascope."});let l=(0,s.jsx)(ty,{appSelection:a,setAppSelection:i,onClose:r});return e?l:(0,s.jsx)(tp,{children:l})});function ty({onClose:e,appSelection:t,setAppSelection:r}){let f=a.useRef(null),m=a.useRef(null),{windowInnerWidth:g}=(0,l.l)(),[y,b]=(0,n.fp)(tb),[_,v]=(0,n.fp)(t_),[S,w]=(0,i.i)({onDrag(e){let t=e.clientX/g;b(`${(100*t).toFixed(2)}%`)}}),[C,I]=(0,i.i)({onDrag(e){let t=m.current;if(!t)return;let r=(e.clientX-t.getBoundingClientRect().left)/t.clientWidth;v(`${(100*r).toFixed(2)}%`)}}),T=(0,n.Xr)(k.jI),E=(0,n.Xr)(k.JN),j=a.useCallback(e=>{let t=f.current;document.activeElement!==t&&(e.keyCode===d.Uz.FORWARD_SLASH&&t?(t.focus(),e.preventDefault()):e.keyCode===d.Uz.BRACKET_LEFT?(o.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"prev",source:"keyboard"}),T()):e.keyCode===d.Uz.BRACKET_RIGHT&&(o.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"next",source:"keyboard"}),E()))},[T,E]),N=(0,n.md)(p.Cc);window.figmaScope=N,window.figmaScopeScene=N,function(e){let[t,r]=(0,n.fp)(x);t.status===c.r.SUCCESS&&e?.setSceneGraphValidationInfo?.(t.value),(0,a.useEffect)(()=>{r()},[r])}(N);let A=(0,n.md)(k.AJ),R=(0,n.md)(k.gg),M=(0,n.md)(h.tH);return(0,s.jsx)(k.q,{appSelection:t,setAppSelection:r,children:(0,s.jsxs)("div",{className:tm.zr,style:u.sx.if(S||C,{cursor:"ew-resize"}).$,onKeyDown:j,children:[(0,s.jsxs)("div",{className:tm.Pd,style:{width:y},children:[(0,s.jsx)(e7,{searchRef:f}),(0,s.jsxs)(e8.o,{className:tm._H,children:[(0,s.jsx)("div",{...w({style:{position:"absolute",top:0,bottom:0,right:"-3px",width:"5px",gridArea:"center",cursor:"ew-resize",zIndex:9}})}),(0,s.jsx)(ek,{appSelection:t})]})]}),(0,s.jsxs)("div",{className:tm.io,children:[(0,s.jsx)(to,{selectedObject:R,diffObject:M,onClose:e}),(R||M)&&(0,s.jsxs)("div",{className:tm._t,ref:m,children:[(0,s.jsxs)(e8.o,{className:tm.S3,style:{width:_},children:[(0,s.jsx)("div",{...I({style:{position:"absolute",top:0,bottom:0,right:"-3px",width:"5px",gridArea:"center",cursor:"ew-resize",zIndex:9}})}),(0,s.jsx)(te.P,{panel:"middle",items:R?.rawProperties,diffItems:M?.rawProperties,extraItems:void 0},A)]}),(0,s.jsx)(e8.o,{className:tm.xK,children:(0,s.jsx)(te.P,{panel:"right",items:R?.computedProperties,diffItems:M?.computedProperties,extraItems:N.getAdditionalProperties?.(A)},A)})]})]})]})})}let tb=(0,C.Sv)("leftPanelWidth","35%"),t_=(0,C.Sv)("rightPanelWidth","50%")},662441:(e,t,r)=>{r.d(t,{BP:()=>u,_J:()=>d,xO:()=>l});var s=r(906338),a=r(778038),i=r(120401),n=r(56857),o=r(223697);let l=(e,t)=>async r=>{if(!e){let e="Thread ID is required to upload tool result to blob store";return(0,i.fL)(new i.fC(e),"upload_to_blob_store",{fileKey:t}),{state:"uploadFailed",error:e}}let s=await o.M.uploadJsonBlobs(t,e,[r]);if(s.success){let a=s.resultItems[0];if(!a){let r="Blobstore upload succeeded but no result was returned";return(0,i.fL)(new i.fC(r),"upload_to_blob_store",{fileKey:t,threadId:e}),{state:"uploadFailed",error:r}}return(0,i.pF)("Uploaded tool result to blob store",a),{state:r.success?"success":"toolFailed",blobstoreContentKey:a.contentKey}}{let r=`Failed to upload tool result to blob store: ${s.error}`;return(0,i.fL)(new i.fC(r),"upload_to_blob_store",{fileKey:t,threadId:e}),{state:"uploadFailed",error:r}}},d=({fileKey:e,threadId:t,userFlow:r})=>async a=>{let n=await r.measureDurationAsync("uploadContentToBlobstore",async r=>{let s=await o.M.uploadBlobs(e,t,a);return r.addContext({statusCode:s.success?"200":"500",aiChatThreadId:t}),s});if(!n.success)return(0,i.fL)(new i.Tv(`Failed to upload content to blobstore: ${n.error}`),"upload_to_blob_store",{fileKey:e,threadId:t,cause:n.error}),n;let l=n.resultItems.length,d=n.resultItems.filter(e=>e.entityAlreadyExisted).length;return(0,i.nH)(`Uploaded ${l} items to Blobstore (${d} already existed)`,n),r.addAction("uploadedToBlobstore",s.$b.INFO,{numUploaded:l,numAlreadyExisted:d}),n};async function c(e){let t,r;try{let s=await n.Ay.crossOriginGet(e,null,{responseType:"blob",retryCount:2});200===s.status?t=s.data:r=s.cause??Error(`Failed to fetch blob (${s.status}): ${s.data}`)}catch(e){r=e instanceof Error?e:Error(String(e))}return{blob:t,error:r}}let u=new a.XO(o.M,(e,t)=>(0,i.fL)(e,"ai_chat_blobstore_cache",t),c,i.nH)},89012:(e,t,r)=>{r.d(t,{Sw:()=>m,bg:()=>_,bz:()=>w,cD:()=>x,dJ:()=>g,p:()=>v,qM:()=>S,sc:()=>b,th:()=>y});var s=r(716976),a=r(897701),i=r(633715),n=r(692564),o=r(536760),l=r(120401),d=r(565698),c=r(790627),u=r(490384),h=r(520356),p=r(889323);function f(e){return s.useMemo(()=>"errors"!==e.status?[]:e.errors.filter(e=>!e.retriable),[e.status,e.errors])}function m({isEnabled:e,fileKey:t,nodeGuid:r}){let a=(0,h.iZ)(),i=e&&t&&r&&a,n=(0,d.Rs)((0,p.Zrv)(i?{ownerId:t,nodeGuid:r}:null)),o=n.data?.nodeAiChatThreads?.[0]??null,c=f(n);return s.useEffect(()=>{e&&0!==c.length&&(0,l.fL)(new l.Tv("Errors occurred while querying Livegraph NodeAiChatThreadsView"),"nodeaichatthreadsview_initial_view_fail",{subscriptionErrors:JSON.stringify(c),fileKey:t,nodeGuid:r})},[e,c,t,r]),{threadId:o?.id??null,isOldFile:o?"old_file"===o.nodeGuid:null,subscriptionStatus:n.status,latestUserMessage:o?.latestUserMessage??null}}function g(e,t,r,a,i){let n=(0,d.Rs)((0,p.r3i)(e?{ownerId:e}:null)),o=f(n);s.useEffect(()=>{0!==o.length&&(0,l.fL)(new l.fC("Errors occurred while querying Livegraph FileAiChatThreadsView"),"fileaichatthreadsview_initial_view_fail",{subscriptionErrors:JSON.stringify(o),fileKey:e})},[o,e]);let c=n.data?.fileAiChatThreads?.[0]?.id??null,u="loaded"!==n.status,[h,m]=s.useState(null),g=h??c,b=e&&g?{ownerId:e,id:g}:null,_=(0,d.Rs)((0,p.A6w)(b)),v=_.data?.activeAiChatThread??null;return s.useEffect(()=>{if(!v||!g||i)return;let e=v.messages.map(y);m(e=>(e!==g&&(0,l.pF)(`Livegraph threadId updating: ${e} => ${g}`),g));let s=a();e.length>s.length+t&&((0,l.pF)("LiveGraph ActiveAiChatThread updating =>",e),r(e))},[v,a,r,g,t,i,m]),{threadId:i?null:g,setThreadId:m,isLoadingThreadId:u}}function y(e){let t=(e.parts??[]).map(({partType:e,contentPb:t,isContentCompressed:r,blobstoreContentKey:s})=>{if(!(0,a.pQ)(e))return(0,l.D5)(`Unknown message part type when converting Livegraph message to AiChatMessage: ${e}. This part will be ignored.`),null;let{type:n,...o}=(0,a.H)(e,t,{isContentCompressed:(0,c.oA)(r)??!1});return(0,i.N)({type:n,contentJson:o,blobstoreContentKey:s})}).filter(e=>null!==e);return(0,n.O)({id:e.id,role:e.role,index:"messageIndex"in e?e.messageIndex:void 0,content:t,createdAtMs:e.createdAt.getTime(),clientId:e.clientId??void 0,userId:"user"in e?e.user?.id??void 0:void 0,guid:"nodeGuid"in e?e.nodeGuid??void 0:void 0,scenegraphSentAt:"scenegraphSentAt"in e?e.scenegraphSentAt??void 0:void 0})}function b({chatMessagesNode:e,disabled:t}){let r=(0,o.md)(u.ze),s=!t&&r&&e,{threadId:a,subscriptionStatus:i}=m({isEnabled:!!s,fileKey:r,nodeGuid:e?.guid||""}),n=!t&&s&&a,l=(0,d.Rs)((0,p.A6w)(n?{ownerId:r,id:a}:null),{enabled:!!n});return{thread:l.data?.activeAiChatThread??null,subscriptionStatus:l.status??i}}let _=100;function v({chatMessagesNode:e,disabled:t}){let r=(0,o.md)(u.ze),s=!t&&r&&e,{threadId:a,subscriptionStatus:i}=m({isEnabled:!!s,fileKey:r,nodeGuid:e?.guid||""}),n=(0,d.Rs)((0,p.nmx)(!t&&s&&a?{ownerId:r,id:a,firstPageSize:_}:null));return{thread:n.data?.activeAiChatThread??null,subscriptionStatus:n.status??i}}let S={numberOfMessages:0,lastMessageUpdatedAt:new Date(0),lastMessageId:""};function x(e){let t=e.length,r=e[t-1];return{numberOfMessages:t,lastMessageUpdatedAt:r?.updatedAt??new Date(0),lastMessageId:r?.id??""}}function w(e,t){return null!=e&&null!=t&&e.numberOfMessages===t.numberOfMessages&&e.lastMessageUpdatedAt.getTime()===t.lastMessageUpdatedAt.getTime()&&e.lastMessageId===t.lastMessageId}},20197:(e,t,r)=>{if(r.d(t,{A:()=>h,m:()=>u}),443==r.j)var s=r(152469);var a=r(801070),i=r(711839),n=r(611769),o=r(492221),l=r.n(o);if(443==r.j)var d=r(76404);var c=r(890),u=(e=>(e.NO_CHANGES="noChanges",e.NOT_INITIALIZED="notInitialized",e.CANCELED="canceled",e.SUCCESS="success",e.FAILED="failed",e))(u||{});class h{constructor(e){this.lastRenderError=null,this.nextRenderError=null,this.lastRenderedParameters=null,this.nextRenderParameters=null,this.lastRenderedDependencies=null,this.nextRenderedDependencies=null,this.rendering=!1,this.queuedRenderItem=null,this.internalRenderCount=0,this.internalRenderWindowStart=Date.now(),this.sitesPreview=e}update(e,t){null===e?(this.nextRenderError=null,this.nextRenderParameters=null,this.nextRenderedDependencies=null):e instanceof Error?(this.nextRenderError=e,this.nextRenderParameters=null,this.nextRenderedDependencies=null):(this.nextRenderError=null,this.nextRenderParameters=e,this.nextRenderedDependencies=t??null)}async render(e){var t,r;let o=this.nextRenderError;if(e.onlyIfChanged&&o&&(t=this.lastRenderError)instanceof Error&&o instanceof Error&&t.name===o.name&&t.message===o.message&&t.stack===o.stack)return{type:"noChanges"};if(o)throw this.logAndAssertRendersInternally(o),this.lastRenderError=o,this.nextRenderError=null,o;let c=this.nextRenderParameters;if(!c)return{type:"notInitialized"};let u=this.nextRenderedDependencies;if(!u)return{type:"notInitialized"};let h=function(e,t){if(null===e||null===t)return e===t?new Set:new Set([null===e?"null->not-null":"not-null->null"]);let r=new Set;for(let s of l()([...Object.keys(e.primitives),...Object.keys(t.primitives)]))e.primitives[s]!==t.primitives[s]&&r.add(`primitives.${s}`);for(let s of l()([...Object.keys(e.pure),...Object.keys(t.pure)]))e.pure[s]!==t.pure[s]&&r.add(`pure.${s}`);for(let s of l()([...Object.keys(e.deepEqual),...Object.keys(t.deepEqual)]))(0,a.c2)(e.deepEqual[s],t.deepEqual[s])||r.add(`deepEqual.${s}`);return r}(this.lastRenderedParameters,c),p=null===(r=this.lastRenderedDependencies)||null===u?r!==u:!(0,a.c2)(r.deepEqual,u.deepEqual);if(e.onlyIfChanged&&0===h.size&&!p)return{type:"noChanges"};this.logAndAssertRendersInternally(h);let f=(0,i.UN)().get(c.primitives.nodeId);if(!f||!f.isAlive)throw Error("Node no longer exists in the scene");if(this.rendering)return this.cancelQueuedRender(),this.queuedRenderItem=this.queuedRenderItem??{options:e,deferred:(0,d.v)()},this.queuedRenderItem.deferred.promise;this.rendering=!0,e.onRenderStart?.({reason:this.lastRenderedParameters?"changed":"initial"});let m=(0,n.g)(),g=(0,s.N)().getSourceCodeHash(),y={...u.deepEqual.entrypoint,codeFileExportName:c.primitives.codeFileExportName||"default"};try{let e=await this.sitesPreview.renderComponent({...c.primitives,...c.deepEqual,...c.pure,entrypoint:y,codeBuildId:m});if(e.success)return{type:"success",codeBuildId:m,timedOut:e.timedOut??!1,isCachedPreview:"snapshot"===y.type,sourceCodeHash:g};return{type:"failed",codeBuildId:m,error:e.error,phase:e.phase,isCachedPreview:"snapshot"===y.type,sourceCodeHash:g}}catch(e){return{type:"failed",codeBuildId:m,error:e,phase:"render",isCachedPreview:"snapshot"===y.type,sourceCodeHash:g}}finally{if(this.lastRenderError=null,this.lastRenderedParameters=c,this.lastRenderedDependencies=u,this.rendering=!1,this.queuedRenderItem){let e=this.queuedRenderItem;this.queuedRenderItem=null,setTimeout(()=>{this.render(e.options).then(e.deferred.resolve).catch(e.deferred.reject)},0)}}}destroy(){this.cancelQueuedRender()}cancelQueuedRender(){this.queuedRenderItem&&(this.queuedRenderItem.deferred.resolve({type:"canceled"}),this.queuedRenderItem=null)}logAndAssertRendersInternally(e){if(!(0,c.IX)())return;e instanceof Error?console.debug(`[IframeRenderer]: error changed: ${e.message}`):console.debug(`[IframeRenderer]: parameters changed: ${Array.from(e).join(", ")}`);let t=Date.now(),r=t-this.internalRenderWindowStart;if(r>1e3){this.internalRenderCount=1,this.internalRenderWindowStart=t;return}this.internalRenderCount++,this.internalRenderCount<=10||(console.error(`[IframeRenderer] Excessive renders detected: ${this.internalRenderCount} renders in ${r}ms.`),this.internalRenderCount=0,this.internalRenderWindowStart=t)}}},262191:(e,t,r)=>{if(r.d(t,{o:()=>i}),443==r.j)var s=r(253491);if(443==r.j)var a=r(673713);function i({lifecycle:e,getChatMessagesNodeGuid:t}){let r=e.on("update_completed",({data:e})=>{if(!e.success){(0,s.lc)();return}if(!(0,s.GM)()||!["initial-live","hmr-triggered-update","hmr-triggered-reload","bundle-change-triggered-rerender"].includes(e.updateType))return;(0,s.lc)();let r=t?.();(0,a.x)(r)}),i=e.on("update_failed",()=>{(0,s.lc)()});return()=>{r(),i()}}},824869:(e,t,r)=>{r.d(t,{U:()=>s});class s{constructor(){this.listeners=new Map}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{this.listeners.get(e)?.delete(t)}}emit(e){let t=this.listeners.get(e.type);t&&t.forEach(t=>{t(e)})}clear(){this.listeners.clear()}}},645220:(e,t,r)=>{r.d(t,{w:()=>l});var s=r(350478);if(443==r.j)var a=r(414393);var i=r(20197);if(443==r.j)var n=r(824869);let o=443==r.j?4*6e4:null;class l{constructor({surface:e,planTier:t}){this.fileKey=null,this.firstLiveUpdate=!0,this.currentUpdate=null,this.isMakeEmptyAtLastSync=!0,this.usedCachedPreview=!1,this.nextTriggeredUpdateReason=null,this.lifecycle=new n.U,this.surface=e,this.planTier=t}getPlanTier(){return this.planTier}setProvider(e){this.provider=e}get codeLibraryFormat(){return(0,s.ft)()}cancelCurrentUpdate(){this.resetCurrentUpdate()}markAsReady(e){this.fileKey=e}triggerReload(e){this.nextTriggeredUpdateReason=e}startSync({isMakeEmpty:e}){this.currentUpdate||(this.isMakeEmptyAtLastSync=e,this.currentUpdate={syncStartedAt:new Date,updateType:null,isMakeEmpty:e,syncTimeoutId:setTimeout(()=>{this.emitUpdateFailed("sync-timeout"),this.resetCurrentUpdate()},o)})}startTriggeredUpdate({isCachedPreview:e,reason:t}){if(this.currentUpdate?.updateType||!this.currentUpdate?.syncStartedAt)return;e&&(this.usedCachedPreview=!0);let r=this.nextTriggeredUpdateReason;this.nextTriggeredUpdateReason=null,this.currentUpdate={...this.currentUpdate,updateType:(()=>{if(e)return"initial-cached";if(this.firstLiveUpdate)return this.usedCachedPreview?"initial-transition-to-live":"initial-live";if(r)return r;switch(t){case"initial":return"hmr-triggered-reload";case"changed":return"bundle-change-triggered-rerender";default:return(0,a.S9)(t,null,"Unknown iframe render reason"),"hmr-triggered-reload"}})(),triggeredUpdateTimeoutId:setTimeout(()=>{this.emitUpdateFailed("triggered-update-timeout"),this.resetCurrentUpdate()},3e4)},e||(this.firstLiveUpdate=!1)}completeTriggeredUpdate(e){if(this.currentUpdate&&this.currentUpdate?.updateType!=="hmr-triggered-update")switch(this.currentUpdate.sourceCodeHash=e.sourceCodeHash,e.type){case i.m.SUCCESS:this.flushCurrentUpdate({success:!0,hitRenderTimeout:e.timedOut??!1,failedStep:void 0},{completedAt:new Date});break;case i.m.FAILED:switch(e.phase){case"import":"Failed to fetch"===e.error.message?this.flushCurrentUpdate({success:!1,hitRenderTimeout:!1,failedStep:"network",errorMessage:e.error.message},{completedAt:new Date}):this.flushCurrentUpdate({success:!1,hitRenderTimeout:!1,failedStep:"build",errorMessage:e.error.message},{completedAt:new Date});break;case"render":this.flushCurrentUpdate({success:!1,hitRenderTimeout:!1,failedStep:"render"},{completedAt:new Date});break;default:(0,a.S9)(e.phase,null,"Unknown iframe render result phase"),this.flushCurrentUpdate({success:!1,hitRenderTimeout:!1,failedStep:"unknown"},{completedAt:new Date})}break;default:(0,a.S9)(e,null,"Unknown iframe render result type")}}startHMRUpdate(){this.currentUpdate?.updateType||(this.currentUpdate={...this.currentUpdate,updateType:"hmr-triggered-update",hmrUpdateTimeoutId:setTimeout(()=>{this.flushCurrentUpdate({success:!0,hitRenderTimeout:!1,failedStep:void 0},{completedAt:this.currentUpdate?.hmrCompletedAt??new Date})},1e3)})}completeHMRUpdate(){this.currentUpdate?.updateType==="hmr-triggered-update"&&(this.currentUpdate.hmrCompletedAt=new Date)}handleBuildError(e){this.currentUpdate?.updateType==="hmr-triggered-update"&&this.flushCurrentUpdate({success:!1,hitRenderTimeout:!1,failedStep:"build",errorMessage:e.message},{completedAt:new Date})}handleRuntimeError(e){this.currentUpdate?.updateType==="hmr-triggered-update"&&this.flushCurrentUpdate({success:!1,hitRenderTimeout:!1,failedStep:"render",errorMessage:e.message},{completedAt:new Date})}flushCurrentUpdate(e,{completedAt:t}){if(!this.currentUpdate)return;if(!this.currentUpdate.updateType){this.emitUpdateFailed("missing-update-type"),this.resetCurrentUpdate();return}let r=this.currentUpdate.syncStartedAt?t.getTime()-this.currentUpdate.syncStartedAt.getTime():this.currentUpdate.hmrCompletedAt?t.getTime()-this.currentUpdate.hmrCompletedAt.getTime():0;if(r<=0){this.emitUpdateFailed("invalid-duration"),this.resetCurrentUpdate();return}this.lifecycle.emit({type:"update_completed",data:{...e,updateType:this.currentUpdate.updateType,isMakeEmpty:this.currentUpdate.isMakeEmpty??this.isMakeEmptyAtLastSync,fileKey:this.fileKey??void 0,surface:this.surface,codeLibraryFormat:this.codeLibraryFormat,sourceCodeHash:this.currentUpdate.sourceCodeHash,durationMs:r,planTier:this.planTier,provider:this.provider}}),this.resetCurrentUpdate()}emitUpdateFailed(e){this.lifecycle.emit({type:"update_failed",data:{reason:e,fileKey:this.fileKey??void 0,surface:this.surface,codeLibraryFormat:this.codeLibraryFormat,planTier:this.planTier,provider:this.provider}})}resetCurrentUpdate(){this.currentUpdate?.hmrUpdateTimeoutId&&clearTimeout(this.currentUpdate.hmrUpdateTimeoutId),this.currentUpdate?.triggeredUpdateTimeoutId&&clearTimeout(this.currentUpdate.triggeredUpdateTimeoutId),this.currentUpdate?.syncTimeoutId&&clearTimeout(this.currentUpdate.syncTimeoutId),this.currentUpdate=null}}},317387:(e,t,r)=>{r.d(t,{I:()=>i,Q:()=>n});var s=r(536760);let a=(0,r(7438).Wh)(()=>(0,s.eU)(!1));function i(){s.zl.set(a,!0)}function n(){return(0,s.fp)(a)}},332320:(e,t,r)=>{r.d(t,{A4:()=>o,EO:()=>d,G6:()=>I,IN:()=>k,KU:()=>w,LR:()=>C,No:()=>A,RN:()=>b,cV:()=>_,ck:()=>l,dB:()=>j,iw:()=>u,kU:()=>p,nJ:()=>T,rz:()=>x});var s=r(649892),a=r(304022),i=r(536760),n=r(7438),o=(e=>(e.ALWAYS_ASK="always_ask",e.AUTO_RUN="auto_run",e.DISABLED="disabled",e))(o||{}),l=(e=>(e.LIST_MCP_CLIENTS="list_mcp_clients",e.INSPECT_MCP_CLIENT="add_mcp_client",e))(l||{});let d=(0,i.eU)({screen:"list_mcp_clients",selectedMcpServer:null,isVisible:!1}),c=(0,i.eU)({}),u=(0,i.eU)(e=>e(c),(e,t,r)=>{let s=e(c);if(Array.isArray(r))r.forEach(({toolCallId:e,toolResult:t})=>{t?s[e]=t:delete s[e]});else{let{toolCallId:e,toolResult:t}=r;t?s[e]=t:delete s[e]}t(c,s)}),h=(0,i.eU)(0),p=(0,i.eU)(e=>e(h)>0,(e,t,r)=>{let s=e(h);"start"===r?t(h,s+1):"end"===r&&t(h,Math.max(0,s-1))}),f="mcp-tool-preferences",m="mcp-server-preferences";function g(e){try{localStorage.setItem(m,JSON.stringify(e))}catch(e){console.warn("Failed to save MCP server preferences to localStorage:",e)}}let y=(0,i.eU)(function(){try{let e=localStorage.getItem(m);return e?a.rn.parse(JSON.parse(e)):{}}catch(e){return console.warn("Failed to parse MCP server preferences from localStorage:",e),localStorage.removeItem(m),{}}}()),b=(0,i.eU)(e=>e(y),(e,t,{serverId:r,subset:s})=>{let a=e(y),i=a[r]?.disabled===!0,n={...a};if(n[r]??={disabled:!1},s){if(i)return;let e=`${s}ToolsDisabled`;n[r][e]=!n[r][e]}else n[r].disabled=!n[r].disabled;t(y,n),g(n)});function _(e,t){let r={...i.zl.get(y)};delete r[t],i.zl.set(y,r),g(r);let s={...i.zl.get(S)};Object.keys(s).forEach(t=>{t.startsWith(`mcp__${e}_`)&&delete s[t]}),i.zl.set(S,s),v(s)}function v(e){try{localStorage.setItem(f,JSON.stringify(e))}catch(e){console.warn("Failed to save MCP tool preferences to localStorage:",e)}}let S=(0,i.eU)(function(){try{let e=localStorage.getItem(f);return e?a.Kf.parse(JSON.parse(e)):{}}catch(e){return console.warn("Failed to parse MCP tool preferences from localStorage:",e),localStorage.removeItem(f),{}}}());function x(e){let t=i.zl.get(y);if(t[e])return;let r={...t};r[e]={disabled:!1,writeToolsDisabled:!0},i.zl.set(y,r),g(r)}let w=(0,i.eU)(e=>e(S),(e,t,r)=>{let a=e(S),i=(0,s.YW)(r.serverName,r.toolName),n={...a},o=a[i]?.disabled===!0;switch(r.runSetting){case"auto_run":n[i]={disabled:!1,autoRun:!0};break;case"always_ask":r.readOnly&&o?delete n[i]:n[i]={disabled:!1,autoRun:!1};break;case"disabled":n[i]={disabled:!0}}t(S,n),v(n),r.trackPreferenceUpdate()});function k(e,t){try{let r=(0,s.YW)(e,t),a=i.zl.get(S);return a[r]?.autoRun===!0}catch{return!1}}let C=(0,i.eU)(e=>{let t=e(S),r={};for(let[e,s]of Object.entries(t))r[e]={disabled:s.disabled??!1,autoRun:s.autoRun};return{serverPreferences:e(y),toolPreferences:r}}),I=65,T=(0,n.Wh)(()=>(0,i.eU)(!1)),E=(0,i.eU)({}),j=(0,i.eU)(e=>e(E),(e,t,r)=>{let s={...e(E),[r]:!0};t(E,s)}),N=(0,i.eU)({}),A=(0,i.eU)(e=>e(N),(e,t,r)=>{let s=e(N);if(null===r.clientId){let e={...s};delete e[r.toolCallId],t(N,e)}else t(N,{...s,[r.toolCallId]:r.clientId})})},253491:(e,t,r)=>{r.d(t,{GM:()=>n,aM:()=>i,lc:()=>o});var s=r(536760);let a=(0,r(7438).Wh)(()=>(0,s.eU)(!1));function i(){s.zl.get(a)||s.zl.set(a,!0)}function n(){return s.zl.get(a)}function o(){s.zl.get(a)&&s.zl.set(a,!1)}},359900:(e,t,r)=>{r.d(t,{N:()=>a,l:()=>s});let s=(0,r(751475).H)(null);function a(e){var t;return e?"code"===e.type?e.fullFilePath:"editedFiles"===e.type||"deletedFiles"===e.type?e.files.join(", "):("view_tool"===e.toolName||"write_tool"===e.toolName||"fast_apply_tool"===e.toolName||"edit_tool"===e.toolName||"delete_tool"===e.toolName||"insert_tool"===e.toolName)&&(t=e.partialArgs.path)&&t.includes(".")?e.partialArgs.path:null:null}},618037:(e,t,r)=>{r.d(t,{KF:()=>g,YP:()=>y,di:()=>_,qD:()=>b});var s=r(716976),a=r(649892),i=r(662441),n=r(644216);if(443==r.j)var o=r(801830);var l=r(89012),d=r(120401),c=r(490384),u=r(428444),h=r(672080);if(443==r.j)var p=r(190949);if(443==r.j)var f=r(785927);if(443==r.j)var m=r(144961);function g({chatMessagesNode:e,disabled:t}){let r=(0,c.q5)(),f=r?.key??null,g=!!r?.canEdit;e=t?null:e,s.useEffect(()=>{f&&i.BP.clearCacheIfFileKeyChanged(f)},[f]);let{status:y,data:b}=(0,h.Vc)(f),_="loaded"===y,v=(0,m.gO)(e),S=!!(_&&b&&r&&function(e){switch(e.editorType){case u._Y.FIGMAKE:return!0;case u._Y.SITES:case u._Y.DESIGN:return(0,p.z)("make_chat_sdk_sites_and_design");default:return!1}}(r)&&(0,o.G)(b)),{chatSdkState:x,chatSdkStatus:w}=function({fileKey:e,userCanEditFile:t,shouldQueryChatSdkState:r,chatMessagesNode:a,plan:i,nodeSource:o}){let c=s.useRef(!1),u=a?.guid||"",{threadId:h,isOldFile:p,subscriptionStatus:f}=(0,l.Sw)({isEnabled:!!(r&&e&&u),fileKey:e,nodeGuid:u}),m=p??o.getMessages().length>0,g=s.useRef(e),y=s.useRef(u),[b,_]=s.useState({threadId:h,isOldFile:m,errorOnCreateThread:!1}),v=null!==h&&(h!==b?.threadId||m!==b?.isOldFile),S=e!==g.current||u!==y.current;(v||S)&&(g.current=e,y.current=u,_({threadId:h,isOldFile:m,errorOnCreateThread:!1}));let x=e&&u&&"loaded"===f&&i&&r,w=x&&!t&&null===h;return x&&null===h&&t&&!c.current&&(c.current=!0,(0,n.q)({context:"code_chat",fileKey:e,plan:i,nodeGuid:u,isOldFile:m}).then(e=>{if("error"===e.status&&_({threadId:null,isOldFile:null,errorOnCreateThread:!0}),"created"===e.status){let{threadId:t,isOldFile:r}=e;(0,d.nH)(`Figmake AiChatThread created, id: ${t}, isOldFile?: ${r}`),_({threadId:t,isOldFile:r,errorOnCreateThread:!1})}})),s.useMemo(()=>{let{threadId:e,isOldFile:t,errorOnCreateThread:r}=b,s=f;return(r?s="errors":w&&(s="disabled"),e&&null!=t)?{chatSdkState:{threadId:e,isOldFile:t},chatSdkStatus:s}:{chatSdkState:void 0,chatSdkStatus:s}},[b,f,w])}({fileKey:f,userCanEditFile:g,chatMessagesNode:e,plan:b,shouldQueryChatSdkState:S,nodeSource:v}),k=S&&"errors"!==w&&"disabled"!==w,C=(0,m.eW)(e,f,x?.threadId??null),I=k&&(0,p.z)("make_chat_sdk_read")&&(!x?.isOldFile||(0,p.z)("make_chat_sdk_read_old_files"))&&((0,p.z)("make_chat_sdk_read_pagination")||v.getMessages().length<100);return s.useMemo(()=>{let t=I?C:v,r=[v];k&&r.push(C);let s={readingSource:t,writingSinks:r,isInitialized:!!(_&&e&&(!k||x)),node:e,chatSdkState:x,chatSdkPhase1Enabled:k,nodeChatSource:v};return new a.F1(s)},[e,v,C,I,x,k,_])}function y({overrideCodeLibraryNode:e,disabled:t}){let r=(0,f.hk)();return g({chatMessagesNode:void 0!==e?e:r,disabled:t})}function b({codeFileNode:e,disabled:t}){return g({chatMessagesNode:e,disabled:t})}function _({codeFileNode:e,disabled:t}){return g({chatMessagesNode:e,disabled:t})}},144961:(e,t,r)=>{r.d(t,{CQ:()=>x,HL:()=>I,eW:()=>C,gO:()=>v});var s=r(716976),a=r(649892),i=r(367322),n=r(174854),o=r(36659),l=r(191427),d=r(536760),c=r(59881),u=r(662441),h=r(89012),p=r(120401),f=r(80512),m=r(750709),g=r(751475);if(443==r.j)var y=r(190949);let b="null-hash",_=(0,g.H)({hash:b,messages:[]});function v(e){let t=e?.guid||"",[r,a]=(0,d.fp)(_(t)),i=(0,d.Pj)(),o=s.useMemo(()=>!!(e&&r.hash!==b),[r.hash,e]),l=s.useCallback(()=>{e&&a({hash:e.chatMessagesHash??b,messages:e.chatMessages_DEPRECATED||[]})},[e,a]),c=(0,m.Fk)((e,t)=>t?.chatMessagesHash??b,e);s.useEffect(()=>{e&&c&&c!==r.hash&&l()},[l,e,c,r.hash,t]);let u=s.useCallback(()=>i.get(_(t)).messages??[],[i,t]),h=s.useCallback((r,s)=>{if(!o||!e)return;S("appendChatMessages",s,u());let a=(0,f.r)(()=>e.appendChatMessages(r));if(!a.success)throw(0,p.fL)(new p.Tv("appendChatMessages failed in C++"),"chat_controller_append_messages",{nodeGuid:t,error:a.error}),new p.Tv(`appendChatMessages failed in C++: ${a.error}`);i.set(_(t),{hash:a.chatMessagesHash,messages:[...a.existing,...a.appended]})},[o,e,i,t,u]),g=s.useCallback((r,s)=>{if(!o||!e||0===r.length)return;S("editChatMessages",s,u()),(0,n.z7)(r);let a=(0,f.r)(()=>e.editChatMessages(r));if(!a.success)throw(0,p.fL)(new p.Tv("editChatMessages failed in C++"),"chat_controller_edit_messages",{nodeGuid:t,error:a.error}),new p.Tv(`editChatMessages failed in C++: ${a.error}`);i.set(_(t),{hash:a.chatMessagesHash,messages:a.updatedMessages})},[o,e,i,t,u]);return s.useMemo(()=>({getMessages:u,appendMessages:h,editMessages:g,SLOW_populateNodeChatCache:l,isInitialized:o}),[u,h,g,l,o])}function S(e,t,r){if(t.flushFileSeqNum<0)throw new p.Tv(`${e}: flushFileSeqNum must be >= 0`);if(null!==t.lastDbMessageIndex){let s=t.lastDbMessageIndex+1,a=r.length,i={commitContext:e,flushFileSeqNum:t.flushFileSeqNum,dbLength:s,scenegraphLength:a};a<s?((0,p.D5)("Scenegraph is behind the database",i),c.az.trackDefinedEvent("chat_sdk.validate_before_commit.scenegraph_behind",i)):a>s?c.az.trackDefinedEvent("chat_sdk.validate_before_commit.scenegraph_ahead",i):c.az.trackDefinedEvent("chat_sdk.validate_before_commit.scenegraph_in_sync",i)}}function x(e){return(0,d.md)(_(e)).hash!==b}let w=(0,g.H)({messages:[]}),k=(0,g.H)({messages:[]});function C(e,t,r){let a=function(e,t,r){let[a,i]=(0,d.fp)(w(e?.guid||"")),n=s.useRef(h.qM),c=((0,y.z)("make_chat_sdk_read")&&(0,y.z)("make_chat_sdk_read_pagination"))??!1,f=(0,y.z)("make_chat_sdk_read")&&e,{thread:m,subscriptionStatus:g}=(0,h.sc)({chatMessagesNode:e,disabled:!f||c}),{thread:b,subscriptionStatus:_}=(0,h.p)({chatMessagesNode:e,disabled:!f||!c}),v=c?b:m,S=c?"loaded"!==_:"loaded"!==g,x=s.useMemo(()=>!!(!f||v&&!S),[f,v,S]),k=s.useMemo(()=>c?[...b?.paginatedMessages??[]].reverse():m?.messages??[],[c,b,m]);s.useEffect(()=>{if(!x||!v||!t||!r)return;let e=(0,h.cD)(k);if(!(0,h.bz)(e,n.current)){let s=k.map(h.th);i({messages:s}),n.current=e,(0,p.nH)("[Pre-blobstore] Updated local cache with AiChatMessages",{thread:v,aiChatMessages:s}),(0,o.V)({aiChatMessages:s,partTypesToHydrate:l.NE,shouldHydrateToolCallback:l.eY,blobstoreCache:u.BP,threadId:r,fileKey:t,logWarn:p.D5}).then(({aiChatMessages:t,numHydratedRefParts:r})=>{r>0?(i({messages:t}),n.current=e,(0,p.nH)("[Post-blobstore] Updated local cache with hydrated AiChatMessages",{aiChatMessages:t,numHydratedRefParts:r})):(0,p.nH)("No ref parts to hydrate, skipping re-render")}).catch(e=>{(0,p.nH)("Error hydrating chat messages from blobstore",e),n.current=h.qM})}},[v,x,i,k,t,r]);let C=s.useCallback(()=>a.messages,[a.messages]),I=s.useCallback(()=>{},[]),T=s.useCallback(()=>{},[]),E=s.useMemo(()=>{if(!c||!b)return;let e=b.paginatedMessages;return{loadNextPage:t=>{(0,p.nH)("Loading next page of messages",{count:t??h.bg}),e.loadNext(t??h.bg)},hasMore:e.hasNextPage(),isLoading:e.isLoadingNextPage,totalCount:void 0}},[c,b]);return s.useMemo(()=>({getMessages:C,editMessages:I,appendMessages:T,isInitialized:x,pagination:E}),[C,I,T,x,E])}(e,t,r),i=a.getMessages(),[n,c]=(0,d.fp)(k(e?.guid||"")),f=((0,y.z)("make_chat_sdk_read")&&(0,y.z)("make_chat_sdk_read_pagination"))??!1;s.useEffect(()=>{if(0===i.length)return;let e=i.map(o.Y);c({messages:e}),(0,p.nH)("Set NodeChat cache with converted AiChatMessages",{aiChatMessages:i,convertedMessages:e,paginationEnabled:f})},[i,c,f]);let m=s.useCallback(()=>n.messages,[n.messages]),g=s.useCallback(()=>{},[]),b=s.useCallback(()=>{},[]),_=s.useMemo(()=>{if(!a.pagination)return;let e=i.length===n.messages.length;return{...a.pagination,isLoading:a.pagination.isLoading||!e}},[a.pagination,i.length,n.messages.length]);return s.useMemo(()=>({getMessages:m,editMessages:g,appendMessages:b,isInitialized:a.isInitialized,pagination:_}),[m,g,b,a.isInitialized,_])}function I(e){let t=e?.getMessages();return s.useMemo(()=>t?(0,i.Qf)((0,a.BM)(t),!1):[],[t])}},673713:(e,t,r)=>{let s,a;r.d(t,{x:()=>f});var i=r(452247),n=r(536760),o=r(890),l=r(214735),d=r(317387);if(443==r.j)var c=r(332320);if(443==r.j)var u=r(359900);if(443==r.j)var h=r(190949);if(443==r.j)var p=r(655849);function f(e){!function(e){if(!window.AudioContext&&!window.webkitAudioContext||!((0,h.z)("make_ai_play_sound_when_done")&&(0,l.UK)().aiSoundNotificationsEnabled.getCopy()))return;if(function(e){if(!e)return!1;let t=n.zl.get((0,u.l)(e));if(t&&"toolName"in t&&"string"==typeof t.toolName){let e="call_mcp_tool"===t.toolName?t.partialArgs.tool_name:t.toolName;if(!(0,p.t)(e))return!1;let{serverName:r,serverToolName:s}=(0,i.Tr)(e);return!(0,c.IN)(r,s)}return!1}(e)){let e=(0,o.ck)("bdd09dc4f2b8b0ed5a25d91b64a8e18314454a99");void 0===a&&(a=new Audio(e)),a.play().catch(e=>{console.error("Could not play tool call sound:",e)});return}let t=(0,o.ck)("f8397f9039d99d6277682f02c7a4155a56bf95fd");void 0===s&&(s=new Audio(t)),s.play().catch(e=>{console.error("Could not play generation complete sound:",e)})}(e),(0,d.I)()}},655849:(e,t,r)=>{r.d(t,{c:()=>i,t:()=>a});var s=r(452247);function a(e){return e.startsWith(s.lh)}function i(e){return e.startsWith(s.Jz)}},379181:(e,t,r)=>{r.d(t,{b:()=>m,e:()=>u});var s=r(350478);if(443==r.j)var a=r(414393);var i=r(24989),n=r(208265),o=r.n(n),l=r(614291),d=r(537550),c=r(266132),u=(e=>(e.EmbedKit="embed_kit",e.DesignPlayableMakesOnCanvas="design_playable_makes_on_canvas",e.DesignInSeparateTabPreview="design_in_separate_tab_preview",e.DesignInFloatingModalPreview="design_in_floating_modal_preview",e.MakeStandalone="make_standalone",e.SitesInFloatingModal="sites_in_floating_modal",e.Testing="testing",e))(u||{});let h={code_bundle_start:null,code_bundle_stop:null,preview_website_bundle_start:null,preview_website_bundle_stop:null,asset_generation_start:null,asset_generation_stop:null,render_start:null,render_stop:null,sandbox_create_start:null,sandbox_create_stop:null,files_patch_start:null,files_patch_stop:null,update_package_json_start:null,update_package_json_stop:null,install_dependencies_start:null,install_dependencies_stop:null,import_module_start:null,import_module_stop:null,cached_preview_urls_load_start:null,cached_preview_urls_load_stop:null,cached_preview_iframe_load_start:null,cached_preview_iframe_load_stop:null,flush_and_get_sequence_number_start:null,flush_and_get_sequence_number_stop:null},p={code_bundle_start:null,preview_website_bundle_start:null,asset_generation_start:null,render_start:null,sandbox_create_start:null,files_patch_start:null,update_package_json_start:null,install_dependencies_start:null,import_module_start:null,cached_preview_urls_load_start:null,cached_preview_iframe_load_start:null,flush_and_get_sequence_number_start:null};function f({start:e,stop:t}){return Math.max(0,e&&t&&t-e||0)}class m{constructor({isFoundry:e,surface:t}){this.initTime=null,this.userFlow=null,this.buildMetadata=null,this.loadMetadata={},this.syncMetadata={},this.durationVitalMap={...p},this.timingMap={...h},this.isFirstBuild=!0,this.isFoundry=e,this.surface=t}reset(){this.timingMap={...h},this.durationVitalMap={...p},this.initTime=null,this.userFlow=null,this.isFirstBuild=!1,this.buildMetadata=null,this.loadMetadata={}}record(e){this.initTime||(this.initTime=performance.now()),this.userFlow||(this.userFlow=d.J.startUserFlow({name:"component_preview",team:i.e.MAKE,context:{is_foundry:this.isFoundry,is_first_build:this.isFirstBuild,surface:this.surface.toString(),code_library_format:(0,s.ft)().toString()}})),null===this.timingMap[e]&&(this.recordDurationVital(e),this.timingMap[e]=performance.now())}recordDurationVital(e){if(this.userFlow)switch(e){case"code_bundle_start":case"preview_website_bundle_start":case"asset_generation_start":case"render_start":case"sandbox_create_start":case"files_patch_start":case"update_package_json_start":case"install_dependencies_start":case"import_module_start":case"cached_preview_urls_load_start":case"cached_preview_iframe_load_start":case"flush_and_get_sequence_number_start":let t=this.userFlow.startDuration(e.replace("_start",""));t.addContext({is_foundry:this.isFoundry,is_first_build:this.isFirstBuild,surface:this.surface.toString(),code_library_format:(0,s.ft)().toString()}),this.durationVitalMap[e]=t;break;case"code_bundle_stop":case"preview_website_bundle_stop":case"asset_generation_stop":case"render_stop":case"sandbox_create_stop":case"files_patch_stop":case"update_package_json_stop":case"install_dependencies_stop":case"import_module_stop":case"cached_preview_urls_load_stop":case"cached_preview_iframe_load_stop":case"flush_and_get_sequence_number_stop":let r=e.replace("_stop","_start");this.durationVitalMap[r]?.stop(),this.durationVitalMap[r]=null;break;default:(0,a.S9)(e,null)}}setBuildMetadata(e){this.buildMetadata=e}setLoadMetadata(e){this.loadMetadata={...this.loadMetadata,...e}}setSyncMetadata(e){this.syncMetadata={...this.syncMetadata,...e}}trackFigmentEvent(){let{code_bundle_start:e,code_bundle_stop:t,preview_website_bundle_start:r,preview_website_bundle_stop:a,asset_generation_start:i,asset_generation_stop:n,render_start:d,render_stop:u,sandbox_create_start:h,sandbox_create_stop:p,files_patch_start:m,files_patch_stop:g,update_package_json_start:y,update_package_json_stop:b,install_dependencies_start:_,install_dependencies_stop:v,import_module_start:S,import_module_stop:x,cached_preview_urls_load_start:w,cached_preview_urls_load_stop:k,cached_preview_iframe_load_start:C,cached_preview_iframe_load_stop:I,flush_and_get_sequence_number_start:T,flush_and_get_sequence_number_stop:E}=this.timingMap;if(!this.initTime){console.error("Component preview performance tracker init time not set. Unable to track figment event.");return}let j=l.D.getState(),N=(this.buildMetadata?.isBuildSuccessful||this.isFoundry?u:t)??performance.now();(0,c.ds)("code_component_preview_perf",j.openFile?.key,o()(j,["selectedView","fileByKey"]),{is_foundry:this.isFoundry,surface:this.surface.toString(),code_library_format:(0,s.ft)().toString(),total_build_and_render_ms:f({start:this.initTime,stop:N}),bundle_code_ms:f({start:e,stop:t}),preview_website_bundle_ms:f({start:r,stop:a}),asset_generation_ms:f({start:i,stop:n}),render_ms:f({start:d,stop:u}),sandbox_create_ms:f({start:h,stop:p}),files_patch_ms:f({start:m,stop:g}),update_package_json_ms:f({start:y,stop:b}),install_dependencies_ms:f({start:_,stop:v}),import_module_ms:f({start:S,stop:x}),cached_preview_urls_load_ms:f({start:w,stop:k}),cached_preview_iframe_load_ms:f({start:C,stop:I}),flush_and_get_sequence_number_ms:f({start:T,stop:E}),npm_install_duration_ms:this.syncMetadata?.npmInstallDuration??0,is_first_build:this.isFirstBuild,is_build_successful:this.buildMetadata?.isBuildSuccessful,is_cached_preview_urls_load_successful:this.loadMetadata?.isCachedPreviewUrlsLoadSuccessful,cached_from_template_id:this.loadMetadata?.cachedFromTemplateId??null,cached_from_template_type:this.loadMetadata?.cachedFromTemplateType??null,force_provisioned:this.loadMetadata?.forceProvisioned,newly_provisioned:this.loadMetadata?.newlyProvisioned,warm:this.loadMetadata?.warm??!1,error_message:this.buildMetadata?.errorMessage,bundle_js_length:this.buildMetadata?.bundleJsLength,bundle_css_length:this.buildMetadata?.bundleCssLength,total_library_code_files:this.buildMetadata?.totalCodeFiles,total_library_code_file_lines:this.buildMetadata?.totalCodeFileLines,total_library_image_imports:this.buildMetadata?.totalImageImports,source_code_hash:this.syncMetadata?.sourceCodeHash,is_sync_successful:this.syncMetadata?.isSyncSuccessful},{forwardToDatadog:!0}),this.userFlow?.end(),this.reset()}}},145427:(e,t,r)=>{r.d(t,{BE:()=>g,EY:()=>h,Er:()=>i,KH:()=>b,ME:()=>s,MF:()=>d,PD:()=>n,Rn:()=>o,U9:()=>u,UX:()=>a,X3:()=>f,bt:()=>l,dw:()=>p,mO:()=>y,mb:()=>m,pc:()=>c});let s=5e3,a=3,i=1e3,n=3e4,o=6e4,l=1e3,d=5e3,c=3,u=6e4,h=3,p=1e3,f=6e4,m=443==r.j?2e4:null,g="pnpm-lock.yaml",y="package.json",b=[g]},431198:(e,t,r)=>{if(r.d(t,{B5:()=>n,PK:()=>o,WR:()=>l}),443==r.j)var s=r(548682);var a=r(890),i=r(403385);function n(e){return(0,s.yS)(e)}function o(e){let t=l(),r=(0,i.fF)()??null;return t&&r?(0,s.yS)(`${e}${t}${r}`):null}function l(){return a.Ay().user_data?.id??null}},367773:(e,t,r)=>{r.d(t,{TT:()=>H,gR:()=>L,Ay:()=>B});var s=r(152469),a=r(361284),i=r(350478),n=r(501416),o=r(379144),l=r(414393),d=r(848165),c=r(24989);class u extends Error{constructor(e="Operation timed out"){super(e),this.name="TimeoutError"}}var h=r(278995),p=r(32714),f=r(711839),m=r(38989),g=r(536760),y=r(59881),b=r(890),_=r(641567),v=r(807729),S=r(218233),x=r(82862),w=r(508866),k=r(720095),C=r(464710),I=r(241207),T=r(162524),E=r(441140),j=r(145427),N=r(550527),A=r.n(N),R=r(492221),M=r.n(R),U=r(230111),F=r(476445);class D{constructor({vfs:e,originHost:t,abortSignal:r,limitRetries:s,codeLibraryFormat:a,perfTracker:i,onSyncPaused:o,onSyncResumed:l,onSyncQueued:d,onSyncEmpty:c,onSyncFailure:u,onResponse:h,provider:p}){this.isPaused=!1,this.pendingResolvers=[],this.syncRequested=!1,this.syncOverdue=!1,this.syncing=!1,this.syncedEntriesByPath={},this.sync=()=>{this.syncRequested=!0,this.onSyncQueued({queuePaused:this.isPaused});let e=new Promise((e,t)=>{this.pendingResolvers.push({resolve:e,reject:t})});return this.isPaused||this.debouncedSync(),e},this.pause=()=>{if(this.isPaused)return;this.isPaused=!0;let e=this.syncRequested;this.debouncedSync.cancel(),this.onSyncPaused({syncRequested:e})},this.resume=()=>{if(!this.isPaused)return;this.isPaused=!1;let e=this.syncRequested;e&&(this.debouncedSync(),this.debouncedSync.flush()),this.onSyncResumed({syncRequested:e})},this.flush=()=>{this.debouncedSync.flush()},this.destroy=()=>{this.debouncedSync.cancel();let e=this.pendingResolvers.slice();this.pendingResolvers=[],e.forEach(({reject:e})=>e((0,n.N)()))},this.debouncedSync=A()(async()=>{if(this.syncing){this.syncOverdue=!0;return}this.syncRequested=!1;let e=this.pendingResolvers.slice();this.pendingResolvers=[];let t=()=>{e.forEach(({resolve:e})=>e())},r=this.vfs.getSourceCodeHash(),s=this.vfs.getCodeIdentifierToEntrypoint(),a=this.listVfsEntriesByPath(),i=this.syncedEntriesByPath,o=M()([...Object.keys(a),...Object.keys(i)]).reduce((e,t)=>{let r=a[t],s=i[t];return!r&&s?e[t]={type:"delete",entry:{path:t,metadata:{guid:s.metadata.guid,version:s.metadata.version,assetVersion:s.metadata.assetVersion}}}:r&&(!s||r.metadata.sha1Hash!==s.metadata.sha1Hash)&&(e[t]={type:"upsert",entry:{path:t,contents:r.contents.toString(),metadata:{guid:r.metadata.guid,version:r.metadata.version,assetVersion:r.metadata.assetVersion,collaborativeVersion:r.metadata.collaborativeVersion,sha1Hash:r.metadata.sha1Hash,makeLibraryId:r.metadata.makeLibraryId}}}),e},{});if(!Object.keys(o).length){t(),this.onSyncEmpty();return}let l=Object.values(a).reduce((e,t)=>(e[t.path]={guid:t.metadata.guid,version:t.metadata.assetVersion,sha1Hash:t.metadata.sha1Hash},e),{});try{this.syncing=!0;let e=await this.syncItems({entriesByPath:o,entrypointsByIdentifier:s,filePathToMetadata:l,sourceCodeHash:r});this.syncing=!1,this.syncedEntriesByPath=a,t();try{this.onResponse(e,"sync")}catch(e){}this.syncOverdue&&(this.syncOverdue=!1,this.isPaused||(this.debouncedSync(),this.debouncedSync.flush()))}catch(r){this.syncing=!1;let t=r instanceof Error?r:Error(String(r));e.forEach(({reject:e})=>e(t)),(0,n.z)(r)||this.onSyncFailure(t)}},j.bt),this.vfs=e,this.originHost=t,this.abortSignal=r,this.limitRetries=s,this.perfTracker=i,this.codeLibraryFormat=a,this.onSyncPaused=o,this.onSyncResumed=l,this.onSyncQueued=d,this.onSyncEmpty=c,this.onSyncFailure=u,this.onResponse=h,this.provider=p}syncItems({entriesByPath:e,entrypointsByIdentifier:t,filePathToMetadata:r,sourceCodeHash:s}){return(0,d.OF)(async()=>{try{let a;(0,m.kc)().make_foundry_flush_before_sync?(this.perfTracker.record("flush_and_get_sequence_number_start"),a=await (0,F.c)(),this.perfTracker.record("flush_and_get_sequence_number_stop")):a=g.zl.get(U.J),this.perfTracker.record("files_patch_start"),this.perfTracker.setSyncMetadata({sourceCodeHash:s});let i=await v.Ay.foundry.sync({entrypointsByIdentifier:t,vfsChangeByPath:e,filePathToMetadata:r,originHost:this.originHost,codeLibraryFormat:this.codeLibraryFormat,sequenceNumber:a},{...(0,S.Ay)()},{abortSignal:this.abortSignal});return this.perfTracker.setSyncMetadata({npmInstallDuration:i.npmInstallDuration,isSyncSuccessful:!0}),i}catch(e){throw this.perfTracker.setSyncMetadata({isSyncSuccessful:!1}),e}finally{this.perfTracker.record("files_patch_stop")}},{times:this.limitRetries?j.EY:void 0,interval:j.dw,exponentialBackoff:!0,maxBackoff:j.U9,abortSignal:this.abortSignal})}listVfsEntriesByPath(){let e=this.vfs.listFiles({depth:1/0,includeHidden:!0,includeSoftDeleted:!1,includeInternal:!1}),t=e.map(e=>this.sanitizedPath(e.path));return new Set(t).size!==t.length&&y.az.trackDefinedEvent("foundry.sync_duplicate_file_paths",{provider:this.provider}),e.reduce((e,t)=>{if(!t.metadata.guid||!t.metadata.assetVersion)return e;let r=this.sanitizedPath(t.path);return j.KH.includes(r)||(e[r]={path:r,contents:t.contents,metadata:{guid:t.metadata.guid,assetVersion:t.metadata.assetVersion,version:t.metadata.assetVersion,collaborativeVersion:t.metadata.collaborativeVersion,sha1Hash:t.metadata.sha1Hash,makeLibraryId:t.metadata.makeLibraryId}}),e},{})}sanitizedPath(e){return e.replace(/^\//,"")}}let O="timeout";function P(e){let t=Error(e.message);return t.name=e.type,t.stack=e.stack,t}function L(e="SandboxManager"){return(0,m.kc)().make_foundry_debug_logs?{info:(t,...r)=>{console.log(`[${e}] ${t}`,...r)},error:(t,...r)=>{console.error(`[${e}] ${t}`,...r)}}:{info:()=>{},error:()=>{}}}var z=(e=>(e.IDLE="IDLE",e.INITIALIZING_SANDBOX="INITIALIZING_SANDBOX",e.SANDBOX_READY="SANDBOX_READY",e.INITIALIZING_CODE="INITIALIZING_CODE",e.READY="READY",e.FAILED="FAILED",e))(z||{}),H=(e=>(e.CACHED_PREVIEW="CACHED_PREVIEW",e.FAILED="FAILED",e.PROVISIONING="PROVISIONING",e.REPROVISIONING="REPROVISIONING",e.PROVISIONED="PROVISIONED",e))(H||{});class B{constructor({originHost:e,fileKey:t,perfTracker:r,logger:a,previewUpdateTracker:i,planTier:c}){this.syncer=null,this.sandboxUrl=null,this._destroyed=!1,this.currentState="IDLE",this.sandboxId=null,this.syncingQueueStateInfo={currentSessionRunningAgentLoop:!1,otherSessionRunningAgentLoop:!1,designToCodeGenerating:!1},this.viteServerErrored=!1,this.stateResolvers=new Map,this.attachHandlers=e=>{this.onStateChange=e.onStateChange},this.attachProperties=({otherSessionRunningAgentLoop:e,designToCodeGenerating:t})=>{this.updateSyncingQueueState({otherSessionRunningAgentLoop:e,designToCodeGenerating:t})},this.initializeSandbox=()=>this.destroyed||"IDLE"!==this.currentState&&"FAILED"!==this.currentState?Promise.resolve():this.transitionTo("INITIALIZING_SANDBOX"),this.initializeCode=async({fromTemplate:e})=>{if(this.destroyed)return Promise.resolve();this.previewUpdateTracker.markAsReady(this.fileKey);let t=new Set(["READY","FAILED"]);return t.has(this.currentState)?Promise.resolve():(this.preloadCachedPreviewUrls({fromTemplate:e}).then(e=>{!e||t.has(this.currentState)||this.onStateChange?.({state:"CACHED_PREVIEW",cachedPreview:e})}).catch(()=>{}),"SANDBOX_READY"===await this.waitForState(["SANDBOX_READY","FAILED"]))?this.transitionTo("INITIALIZING_CODE"):void 0},this.destroy=()=>{this._destroyed=!0,this.resetSandbox()},this.waitForState=e=>{let t=new Set(Array.isArray(e)?e:[e]);return t.has(this.currentState)?Promise.resolve(this.currentState):new Promise(e=>{for(let r of t){let t=this.stateResolvers.get(r)||[];t.push(()=>{e(r)}),this.stateResolvers.set(r,t)}})},this.transitionTo=async(e,t)=>{let r=this.currentState;if(this.currentState=e,r===this.currentState)return;let s=this.stateResolvers.get(e);switch(s&&(s.forEach(e=>e()),this.stateResolvers.delete(e)),e){case"IDLE":case"SANDBOX_READY":break;case"INITIALIZING_SANDBOX":this.onStateChange?.({state:"IDLE"===r?"PROVISIONING":"REPROVISIONING"}),await this.doInitializeSandbox();break;case"INITIALIZING_CODE":await this.doInitializeCode();break;case"READY":this.sandboxUrl&&this.onStateChange?.({state:"PROVISIONED",url:this.sandboxUrl,sandboxId:this.sandboxId}),this.startKeepAlive();break;case"FAILED":{let e=t?.error??"Unknown error";this.onStateChange?.({state:"FAILED",error:e instanceof Error?e:Error(String(e))});break}default:(0,l.S9)(e,void 0,`Unknown state transition: ${e}`)}},this.resetSandbox=()=>{this.previewUpdateTracker.cancelCurrentUpdate(),this.sandboxUrl=null,this.sandboxId=null,this._provider=void 0,this.stopListeningToVfsChanges(),this.abortController.abort(),this.syncer?.destroy(),this.syncer=null,this.unsubscribeChatMessageState?.(),this.abortController=new AbortController},this.doInitializeSandbox=async()=>{try{let e=await this.createSandbox();this.sandboxUrl=e.url,this.sandboxId=e.sandboxId??null,this._provider=e.provider}catch(e){(0,n.z)(e)||(this.transitionTo("FAILED",{error:e}),y.az.trackDefinedEvent("foundry.sandbox_failed",{step:"initializeSandbox_createSandbox",fileKey:this.fileKey,error:e instanceof Error?e.message:String(e),planTier:this.planTier,provider:this.provider}));return}this.transitionTo("SANDBOX_READY")},this.doInitializeCode=async()=>{try{this.syncer=new D({vfs:this.vfs,originHost:this.originHost,abortSignal:this.abortController.signal,limitRetries:!this.uiFoundryEnabled,perfTracker:this.perfTracker,codeLibraryFormat:this.codeLibraryFormat,onSyncPaused:this.handleSyncPaused,onSyncResumed:this.handleSyncResumed,onSyncQueued:this.handleSyncQueued,onSyncEmpty:this.handleSyncEmpty,onSyncFailure:this.handleSyncFailure,onResponse:e=>{this.handleSyncResponse(e)},provider:this._provider}),this.updateSyncingQueueState({chatMessageState:g.zl.get(T.m1)}),this.unsubscribeChatMessageState=g.zl.sub(T.m1,this.handleChatMessageStateChange),this.startListeningToVfsChanges(),await this.syncer.sync(),this.logger.info("Initial sync completed"),this.transitionTo("READY")}catch(e){if(this.stopListeningToVfsChanges(),!(0,n.z)(e))throw this.transitionTo("FAILED",{error:e}),y.az.trackDefinedEvent("foundry.sandbox_failed",{step:"initializeSandbox_sync",fileKey:this.fileKey,codeLibraryFormat:this.codeLibraryFormatStr,error:e instanceof Error?e.message:String(e),planTier:this.planTier,provider:this.provider}),e}},this.handleVfsChanged=async()=>{try{await this.syncer?.sync(),this.logger.info("VFS sync completed")}catch(e){this.logger.error("VFS sync failed:",e instanceof Error?e.message:String(e))}},this.handleChatMessageStateChange=()=>{this.updateSyncingQueueState({chatMessageState:g.zl.get(T.m1)})},this.handleSyncPaused=({syncRequested:e})=>{e&&this.previewUpdateTracker.cancelCurrentUpdate()},this.handleSyncResumed=({syncRequested:e})=>{e&&this.previewUpdateTracker.startSync({isMakeEmpty:(0,E.A)(this.vfs)})},this.handleSyncQueued=({queuePaused:e})=>{e||this.previewUpdateTracker.startSync({isMakeEmpty:(0,E.A)(this.vfs)})},this.handleSyncEmpty=()=>{this.previewUpdateTracker.cancelCurrentUpdate()},this.handleSyncFailure=e=>{this.stopListeningToVfsChanges(),(0,n.z)(e)||(this.transitionTo("FAILED",{error:e}),y.az.trackDefinedEvent("foundry.sync",{fileKey:this.fileKey,sourceCodeHash:(0,s.N)().getSourceCodeHash(),success:!1,codeLibraryFormat:this.codeLibraryFormatStr,error:e.message,planTier:this.planTier,provider:this.provider}))},this.handleSandboxUrlResponse=(e,t)=>{if(this.sandboxUrl&&(!e.url||this.sandboxUrl!==e.url)){this.recreateSandbox();return}switch(t){case"sync":y.az.trackDefinedEvent("foundry.sync",{fileKey:this.fileKey,sourceCodeHash:(0,s.N)().getSourceCodeHash(),success:!0,codeLibraryFormat:this.codeLibraryFormatStr,planTier:this.planTier,provider:this.provider});break;case"keep-alive":y.az.trackDefinedEvent("foundry.keep_alive",{fileKey:this.fileKey,success:!0,codeLibraryFormat:this.codeLibraryFormatStr,planTier:this.planTier,provider:this.provider});break;default:(0,l.S9)(t,void 0,`Unknown source: ${t}`)}},this.startListeningToVfsChanges=()=>{this.vfs.on("change",this.handleVfsChanged)},this.stopListeningToVfsChanges=()=>{this.vfs.off("change",this.handleVfsChanged)},this.createSandbox=async()=>{let e=new AbortController,t=setTimeout(()=>{e.abort(O)},j.PD),r=(0,o.A)([this.abortController.signal,e.signal]);try{return await (0,d.OF)(async()=>{try{this.perfTracker.record("sandbox_create_start");let e=await v.Ay.foundry.sandbox({originHost:this.originHost,provider:(0,m.kc)().make_foundry_modal_override?"modal":(0,m.kc)().make_foundry_cloudflare_override?"cloudflare":void 0},{...(0,S.Ay)(),trackingSessionId:(0,b.Ay)().tracking_session_id},{abortSignal:r});if("PROVISIONED"!==e.state)throw Error(`Sandbox not provisioned: ${e.state}`);return void 0!==e.newlyProvisioned&&this.perfTracker.setLoadMetadata({newlyProvisioned:e.newlyProvisioned}),void 0!==e.warm&&this.perfTracker.setLoadMetadata({warm:e.warm}),e}finally{this.perfTracker.record("sandbox_create_stop")}},{times:j.UX,interval:j.Er,exponentialBackoff:!0,maxBackoff:j.ME,abortSignal:r})}catch(e){if(r.reason===O)throw new u("Sandbox creation timed out");throw e}finally{clearTimeout(t)}},this.startKeepAlive=()=>{let e=setInterval(async()=>{try{if("visible"===document.visibilityState){let e=await v.Ay.foundry.keepAlive({},{...(0,S.Ay)(),trackingSessionId:(0,b.Ay)().tracking_session_id},{abortSignal:this.abortController.signal});this.handleSandboxUrlResponse(e,"keep-alive")}}catch(e){(0,n.z)(e)||y.az.trackDefinedEvent("foundry.keep_alive",{fileKey:this.fileKey,success:!1,codeLibraryFormat:this.codeLibraryFormatStr,error:e instanceof Error?e.message:String(e),planTier:this.planTier,provider:this.provider})}},j.mb);this.abortController.signal.addEventListener("abort",()=>{clearInterval(e)})},this.preloadCachedPreviewUrls=async({fromTemplate:e})=>{if(!this.previewEnabled||(0,E.A)(this.vfs))return null;let t={fileKey:this.fileKey,surface:this.previewUpdateTracker.surface,codeLibraryFormat:this.codeLibraryFormatStr,isMakeEmpty:!1,templateId:e?.template.id,templateType:e?.type,planTier:this.planTier,provider:this.provider};try{this.perfTracker.record("cached_preview_urls_load_start");let r=await (()=>{if(e){if(!this.templatePreviewEnabled)return null;switch(e.type){case x.n.HubFile:return w.H.getCachedPreviewUrls({hubFileId:e.template.id});case x.n.TeamTemplate:return C.q.getCachedPreviewUrls({templateFileKey:e.template.file_key});case x.n.TeamTemplateLg:return C.q.getCachedPreviewUrls({templateFileKey:e.template.fileKey});default:(0,l.xb)(e)}}return k.Z.getCachedPreviewUrls({fileKey:this.fileKey,sourceCodeHash:(0,s.N)().getSourceCodeHash()})})();if(!r)return null;return y.az.trackDefinedEvent("foundry.preview_cache_load",{...t,hit:!0}),this.perfTracker.setLoadMetadata({isCachedPreviewUrlsLoadSuccessful:!0,cachedFromTemplateId:e?.template.id,cachedFromTemplateType:e?.type}),{jsUrl:r.data.meta.js_url,cssUrl:r.data.meta.css_url}}catch(r){return y.az.trackDefinedEvent("foundry.preview_cache_load",{...t,hit:!1}),this.perfTracker.setLoadMetadata({isCachedPreviewUrlsLoadSuccessful:!1,cachedFromTemplateId:e?.template.id,cachedFromTemplateType:e?.type}),null}finally{this.perfTracker.record("cached_preview_urls_load_stop")}},this.updateSyncingQueueState=({chatMessageState:e,otherSessionRunningAgentLoop:t,designToCodeGenerating:r})=>{this.syncingQueueStateInfo={otherSessionRunningAgentLoop:t??this.syncingQueueStateInfo.otherSessionRunningAgentLoop,currentSessionRunningAgentLoop:(()=>{if(!e)return this.syncingQueueStateInfo.currentSessionRunningAgentLoop;switch(e){case T.vO.IN_PROGRESS:case T.vO.AWAITING_COMMIT:return!0;case T.vO.IDLE:case T.vO.COMMITTED:case T.vO.ERROR:return!1;default:return(0,l.S9)(e,void 0,"Unknown chat message state"),!1}})(),designToCodeGenerating:r??this.syncingQueueStateInfo.designToCodeGenerating},this.syncingQueueStateInfo.otherSessionRunningAgentLoop||this.syncingQueueStateInfo.currentSessionRunningAgentLoop||this.syncingQueueStateInfo.designToCodeGenerating?this.syncer?.pause():this.syncer?.resume()},this.getQueuedMetadata=()=>({sourceCodeHash:this.vfs.getSourceCodeHash(),fileEntries:this.vfs.listFiles()}),this.originHost=e,this.abortController=new AbortController,this.perfTracker=r,this.previewUpdateTracker=i,this.vfs=(0,s.N)(),this.fileKey=t,this.logger=a,this.planTier=c,this.previewEnabled=!!(0,m.kc)().make_foundry_cache_preview_client,this.templatePreviewEnabled=!!(0,m.kc)().make_foundry_template_cached_preview,this.uiFoundryEnabled=(0,I.t)()}get destroyed(){return this._destroyed}get initialized(){return"IDLE"!==this.currentState}get provider(){return this._provider}get codeLibraryFormat(){return(0,i.ft)()}get codeLibraryFormatStr(){return this.codeLibraryFormat.toString()}recreateSandbox(){y.az.trackDefinedEvent("foundry.sandbox_recreated",{fileKey:this.fileKey,codeLibraryFormat:this.codeLibraryFormatStr,planTier:this.planTier,provider:this.provider,sourceCodeHash:(0,s.N)().getSourceCodeHash()}),this.resetSandbox(),this.transitionTo("INITIALIZING_SANDBOX"),this.waitForState(["SANDBOX_READY","FAILED"]).then(e=>{"SANDBOX_READY"===e&&this.transitionTo("INITIALIZING_CODE")})}flushSandboxSyncer(){this.syncer?.flush()}handleSyncResponse(e){this.handleSandboxUrlResponse(e,"sync"),this.updatePnpmLockFile(e),!1===e.viteServerSuccessful&&(this.viteServerErrored=!0),e.viteServerError&&this.previewUpdateTracker.lifecycle.emit({type:"vite_server_error",data:{viteServerError:P(e.viteServerError),npmInstallError:e.npmInstallError?P(e.npmInstallError):void 0}}),this.viteServerErrored&&e.viteServerSuccessful&&(this.viteServerErrored=!1,this.previewUpdateTracker.lifecycle.emit({type:"vite_server_recovered"}))}updatePnpmLockFile(e){let{pnpmLockFileContents:t,foundryPackageJsonVersion:r}=e;if(!t||this.codeLibraryFormat<2)return;let n=(0,s.N)().getFileByPath(`/${j.mO}`),o=n?.metadata.assetVersion;if(o&&r&&0>=(0,a.CL)(r,o))return;let l=(0,i._J)(`/${j.BE}`);p.Hq.system("update-pnpm-lockfile",()=>{let e=(0,f.UN)();l?l.sourceCode=t:e.createNewCodeFile({path:j.BE,sourceCode:t,entryPoint:null,isEntrypointCodeFile:!1,onError:e=>{(0,_.$D)(c.e.MAKE,e)},createCodeComponent:!1}),h.glU?.commit()})}}},687280:(e,t,r)=>{r.d(t,{tT:()=>C,Ay:()=>T,Fq:()=>I});var s=r(716976),a=r(152469),i=r(350478),n=r(414393),o=r(32714),l=r(38989),d=r(536760),c=r(59881),u=r(682367),h=r(7438),p=r(807083),f=r(262191),m=r(208265),g=r.n(m),y=r(645220),b=r(375333),_=r(675430),v=r(379181),S=r(785927),x=r(302329),w=r(431198),k=r(367773);let C=1,I=(0,h.Wh)(()=>(0,d.eU)(null));function T({fileKey:e,fileId:t,isFoundryEnabled:r,surface:h}){let m=new URL((0,d.md)(x.jD)).host,C=(0,s.useRef)(new v.b({isFoundry:!0,surface:h})),T=(0,p.No)(),E=T.unwrapOr(null)?.key?.parentId||null,j=T.unwrapOr(null)?.tier,N=(0,s.useRef)(new y.w({surface:h,planTier:j})),[A,R]=(0,s.useState)(!1),M=(0,S.hk)();(0,s.useEffect)(()=>{let e=N.current,t=function(e){let t=e.on("update_completed",({data:e})=>{c.az.trackDefinedMetric("foundry.preview_update",{success:e.success,hitRenderTimeout:e.hitRenderTimeout,failedStep:e.failedStep,errorMessage:e.errorMessage,updateType:e.updateType,isMakeEmpty:e.isMakeEmpty,fileKey:e.fileKey,surface:e.surface,engine:"foundry",codeLibraryFormat:e.codeLibraryFormat.toString(),sourceCodeHash:e.sourceCodeHash,planTier:e.planTier,provider:e.provider}),c.az.trackDefinedMetric("foundry.preview_update_latency",{...g()(e,["success","hitRenderTimeout"]),updateType:e.updateType,isMakeEmpty:e.isMakeEmpty,fileKey:e.fileKey,surface:e.surface,engine:"foundry",codeLibraryFormat:e.codeLibraryFormat.toString(),durationMs:e.durationMs,planTier:e.planTier,provider:e.provider})}),r=e.on("update_failed",({data:e})=>{c.az.trackDefinedEvent("foundry.preview_update_tracking_failure",{fileKey:e.fileKey,surface:e.surface,reason:e.reason,engine:"foundry",codeLibraryFormat:e.codeLibraryFormat.toString(),planTier:e.planTier,provider:e.provider})});return()=>{t(),r()}}(e.lifecycle),r=(0,f.o)({lifecycle:e.lifecycle,getChatMessagesNodeGuid:()=>M?.guid});return()=>{t(),r()}},[M?.guid]);let U=(0,s.useMemo)(()=>!!M,[M]),{user:F}=(0,b.$W)(M?.guid),D=(0,u.KP)(),O=!!F&&F.sessionID!==D,P=(_.ne()?.size??0)>0,L=(0,s.useMemo)(()=>{let e=performance.getEntriesByType("navigation");return e.length>0&&e[0]?.type==="reload"},[]),[z,H]=(0,s.useState)(!1),B=function(){let[e,t]=(0,s.useState)(document.visibilityState);return(0,s.useEffect)(()=>{let e=()=>{t(document.visibilityState)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[]),e}(),$=(0,s.useMemo)(()=>!A&&e&&r?{originHost:m,fileKey:e,logger:(0,k.gR)(),perfTracker:C.current,previewUpdateTracker:N.current,planTier:j}:null,[A,e,r,m,j]),[K,V]=(0,s.useState)($?new k.Ay($):null),q=(0,s.useCallback)(()=>{K&&"visible"===B&&K.recreateSandbox()},[K,B]),G=(0,s.useCallback)(()=>{K?.flushSandboxSyncer()},[K]);(0,s.useEffect)(()=>{r&&1>(0,i.ft)()&&o.l7.system("set-local-code-library-format",()=>{(0,i.lK)(1)})},[r]);let[Y,X]=(0,d.fp)(I);(0,s.useEffect)(()=>{r||X(null)},[r,X]);let J=(0,s.useCallback)(t=>{switch(t.state){case k.TT.PROVISIONING:X({reinitialize:q,flushSandboxSyncer:G,state:k.TT.PROVISIONING,perfTracker:C.current,previewUpdateTracker:N.current});break;case k.TT.CACHED_PREVIEW:X({reinitialize:q,flushSandboxSyncer:G,state:k.TT.CACHED_PREVIEW,cachedPreview:t.cachedPreview,perfTracker:C.current,previewUpdateTracker:N.current});break;case k.TT.REPROVISIONING:X({reinitialize:q,flushSandboxSyncer:G,state:k.TT.REPROVISIONING,perfTracker:C.current,previewUpdateTracker:N.current});break;case k.TT.PROVISIONED:N.current.setProvider(K?.provider),X({reinitialize:q,flushSandboxSyncer:G,state:k.TT.PROVISIONED,url:t.url,perfTracker:C.current,previewUpdateTracker:N.current,sandboxId:t.sandboxId});break;case k.TT.FAILED:{let r=(0,i.ft)();(0,l.kc)().make_foundry_disable_fallback_to_esbuild?X({reinitialize:q,flushSandboxSyncer:G,state:k.TT.FAILED,error:t.error.message,perfTracker:C.current,previewUpdateTracker:N.current}):(R(!0),X(null),e&&c.az.trackDefinedEvent("foundry.fallback_to_esbuild",{fileKey:e,codeLibraryFormat:r.toString(),error:t.error.message,planTier:j,provider:K?.provider}));break}default:(0,n.S9)(t,void 0,"Unknown sandbox state change")}},[K,e,X,q,G,j]),W=(0,s.useCallback)(e=>{K&&K.initializeCode(e)},[K]);return(0,s.useEffect)(()=>{K&&(K.attachHandlers({onStateChange:J}),K.attachProperties({otherSessionRunningAgentLoop:O,designToCodeGenerating:P}))},[K,O,P,J]),(0,s.useEffect)(()=>{$?K||V(new k.Ay($)):V(null)},[$,K]),(0,s.useEffect)(()=>{K&&!K.initialized&&U&&"visible"===B&&(X({reinitialize:q,flushSandboxSyncer:G,state:k.TT.PROVISIONING,perfTracker:C.current,previewUpdateTracker:N.current}),K.initializeSandbox())},[K,U,X,q,G,B]),(0,s.useEffect)(()=>()=>{K?.destroy()},[K]),(0,s.useEffect)(()=>{!z&&K&&e&&(c.az.trackDefinedEvent("foundry.file_open",{fileKey:e,sourceCodeHash:(0,a.N)().getSourceCodeHash(),codeLibraryFormat:(0,i.ft)().toString(),surface:h,hardReloaded:L,planTier:j,provider:K?.provider}),c.az.trackDefinedEvent("foundry.session_context",{fileKey:e,fileKeyHash:(0,w.B5)(e),routingKey:(0,w.PK)(e)??void 0,fileId:t??void 0,userId:(0,w.WR)()??void 0,planParentId:E??void 0,planTier:j,provider:K?.provider}),H(!0))},[L,h,z,K,e,t,E,j]),(0,s.useMemo)(()=>null===Y&&!A&&r?{sandbox:{reinitialize:q,flushSandboxSyncer:G,state:k.TT.PROVISIONING,perfTracker:C.current,previewUpdateTracker:N.current},setCodeReady:W}:{sandbox:Y,setCodeReady:W},[Y,A,r,W,q,G])}},441140:(e,t,r)=>{if(r.d(t,{A:()=>i}),443==r.j)var s=r(923714);if(443==r.j)var a=r(201857);function i(e){return e.listFiles({onlyEntrypoints:s.z.ONLY_USED_ENTRYPOINTS,extensions:[".tsx",".ts",".jsx",".js"]}).some(e=>e.contents===a.jP)}},588863:(e,t,r)=>{r.d(t,{t:()=>i});var s=r(716976),a=r(104076);let i=(0,s.memo)(function(e){return(0,a.jsx)("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 16 16",...e,"data-fpl-icon-size":"16",children:(0,a.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",fillRule:"evenodd",d:"M7.646 6.404a.5.5 0 0 1 .707 0l2.122 2.12a.5.5 0 0 1-.708.708L8 7.464 6.232 9.232a.5.5 0 0 1-.707-.707z",clipRule:"evenodd"})})})},367322:(e,t,r)=>{r.d(t,{EY:()=>d,Qf:()=>o,gG:()=>l});var s=r(649892),a=r(818822);if(443==r.j)var i=r(71041);var n=r(621592);function o(e,t){let r=(0,i.A)(e);return r?r.filter(e=>e.type!==a.K$p.TOOL_MESSAGE).reduce((e,r)=>{let i=r.type===a.K$p.ASSISTANT_MESSAGE,o=r.toolCalls.length>0,l=0===(0,s.H5)(r,t).plainText.length;if(i&&o&&l){let t=e[e.length-1];return t?.type===a.K$p.ASSISTANT_MESSAGE&&(t.toolCalls=n([...t.toolCalls,...r.toolCalls],"toolCallId")),e}return[...e,r]},[]):[]}function l(e){let{hidden:t,errors:r}=e;return!!t&&!!r&&r.length>0&&e.origin!==s.zm.FIX_ERRORS_BUTTON}function d(e){let t=e.slice().reverse().find(e=>e.type===a.K$p.USER_MESSAGE);return t?t.id:null}},633715:(e,t,r)=>{r.d(t,{N:()=>c,t:()=>d});var s=r(153472),a=r(191427),i=r(248005),n=r(897701),o=r(343144);if(443==r.j)var l=r(414393);function d(e){let t=structuredClone(e);switch(t.type){case"text":case"reasoning":case"redacted-reasoning":return{...t,providerOptions:{}};case"selected-node-ids":case"enabled-libraries":case"jsx":case"cortex-request-uuid":case"code-chat-assistant-code":case"code-chat-assistant-text":case"code-chat-assistant-title":case"code-chat-model-config-version":case"code-chat-legacy-s3-code-snapshot":case"code-chat-errors":case"code-chat-library-keys":case"code-chat-origin":case"code-chat-legacy-assistant-tool-result":case"code-chat-snapshot-restore":case"code-chat-backfill-image-import":case"code-chat-backfill-diff-import":case"code-chat-backfill-inspected-element":return t;case"tool-call":{let{toolCallId:e,toolName:r,argsJSON:s,providerOptions:a}=t;return{type:"tool-call-json-DO-NOT-USE-IN-PROD",toolCallId:e,toolName:r,argsJson:s,providerOptions:a??{}}}case"tool-result":{let{toolCallId:e,toolName:r,resultJSON:s,isError:a}=t;return{type:"tool-result-json-DO-NOT-USE-IN-PROD",toolCallId:e,toolName:r,resultJson:s,isError:a,providerOptions:{}}}case"tool-result-ref":{let{toolCallId:e,toolName:r,isError:s}=t;return{type:"tool-result-ref",toolCallId:e,toolName:r,isError:s,providerOptions:{}}}case"code-chat-backfill-code-import":{let{codeFiles:e,...r}=t;return{...r,codeFiles:e??[]}}case"code-chat-provider-metadata":return{type:"code-chat-provider-metadata",providerMetadataJson:JSON.stringify(t.providerMetadata)};case"code-chat-code-import-ref":case"code-chat-image-import-ref":case"code-chat-diff-import-ref":case"code-chat-code-snapshot":return{type:t.type};case"code-chat-inspected-element-ref":{let{blobstoreContentKey:e,...r}=t;return r}case"code-chat-inspected-component":return{type:t.type,filePath:t.filePath,tagName:t.tagName};case"code-chat-inspected-library":return{type:t.type,folderPath:t.folderPath,libraryName:t.libraryName};case"code-chat-manual-edit":return{type:t.type,changedFilesJson:JSON.stringify(t.changedFiles),title:t.title,legacyS3CodeSnapshotKey:t.legacyS3CodeSnapshotKey};case"code-chat-duplicated-file":return{type:t.type,plainText:t.plainText,fileKeyHash:t.fileKeyHash};case"code-chat-deleted-chat-history":return{type:t.type,timestamp:t.timestamp,userId:t.userId??""};case"image":throw new s.T(`Not implemented: Conversion from part type ${t.type} to protobuf not implemented`);default:(0,l.xb)(t)}}function c({type:e,contentJson:t,blobstoreContentKey:r}){if(!(0,n.pQ)(e))throw new s.T(`Unknown message part type: ${e}`);let d=i.l[e].fromJSON(t),c={type:e,...d};switch(c.type){case"text":case"reasoning":case"redacted-reasoning":case"selected-node-ids":case"enabled-libraries":case"jsx":case"cortex-request-uuid":case"code-chat-assistant-code":case"code-chat-assistant-title":case"code-chat-model-config-version":case"code-chat-legacy-s3-code-snapshot":case"code-chat-errors":case"code-chat-library-keys":case"code-chat-legacy-assistant-tool-result":case"code-chat-snapshot-restore":case"code-chat-duplicated-file":case"code-chat-deleted-chat-history":case"code-chat-backfill-image-import":case"code-chat-backfill-code-import":case"code-chat-backfill-diff-import":case"code-chat-backfill-inspected-element":return c;case"code-chat-manual-edit":{let e;let{title:t,changedFilesJson:r,legacyS3CodeSnapshotKey:i}=d;try{let t=JSON.parse(r);e=a.Op.shape.changedFiles.parse(t)}catch(t){let e=t instanceof Error?t.message:String(t);throw new s.T(`Invalid changedFiles for code-chat-manual-edit: ${e}`)}return{type:"code-chat-manual-edit",changedFiles:e,title:t,legacyS3CodeSnapshotKey:i,blobstoreContentKey:void 0}}case"code-chat-origin":{let{origin:e}=d,t=a.Iw.shape.origin.safeParse(e);if(!t.success)throw new s.T(`Invalid origin for code-chat-origin: ${e}`);return{type:"code-chat-origin",origin:t.data}}case"tool-call-json-DO-NOT-USE-IN-PROD":{let{toolCallId:e,toolName:t,argsJson:r,providerOptions:s}=d;return{type:"tool-call",toolCallId:e,toolName:t,argsJSON:r,providerOptions:s}}case"tool-result-json-DO-NOT-USE-IN-PROD":{let{toolCallId:e,toolName:t,resultJson:r,isError:s}=d;return{type:"tool-result",toolCallId:e,toolName:t,resultJSON:r,isError:s}}case"tool-result-ref":{if(!r)throw new s.T("Blobstore content key is required for tool-result-ref");let{toolCallId:e,toolName:t,isError:a}=d;return{type:"tool-result-ref",toolCallId:e,toolName:t,isError:a,blobstoreContentKey:r}}case"code-chat-assistant-text":{let{text:e,textMode:t}=d,r=o.w_.safeParse(t);if(!r.success)throw new s.T(`Invalid textMode for code-chat-assistant-text: ${t}`);if("code"===r.data)throw new s.T("Code mode messages should be represented by code-chat-assistant-code, not code-chat-assistant-text");return{type:"code-chat-assistant-text",text:e,textMode:r.data}}case"code-chat-provider-metadata":return{type:"code-chat-provider-metadata",providerMetadata:JSON.parse(d.providerMetadataJson)};case"code-chat-code-snapshot":if(!r)throw new s.T("Blobstore content key is required for code-chat-code-snapshot");return{type:"code-chat-code-snapshot",blobstoreContentKey:r};case"code-chat-image-import-ref":if(!r)throw new s.T("Blobstore content key is required for code-chat-image-import-ref");return{type:"code-chat-image-import-ref",blobstoreContentKey:r};case"code-chat-code-import-ref":if(!r)throw new s.T("Blobstore content key is required for code-chat-code-import-ref");return{type:"code-chat-code-import-ref",blobstoreContentKey:r};case"code-chat-diff-import-ref":if(!r)throw new s.T("Blobstore content key is required for code-chat-diff-import-ref");return{type:"code-chat-diff-import-ref",blobstoreContentKey:r};case"code-chat-inspected-element-ref":{if(!r)throw new s.T("Blobstore content key is required for code-chat-inspected-element-ref");let{filePath:e,snippetStartLine:t,tagLine:a,tagName:i}=d;return{type:"code-chat-inspected-element-ref",filePath:e,snippetStartLine:t,tagLine:a,tagName:i,blobstoreContentKey:r}}case"code-chat-inspected-component":{let{filePath:e,tagName:t}=d;return{type:"code-chat-inspected-component",filePath:e,tagName:t}}case"code-chat-inspected-library":{let{folderPath:e,libraryName:t}=d;return{type:"code-chat-inspected-library",folderPath:e,libraryName:t}}case"text-ref":case"image-ref":case"reasoning-ref":case"redacted-reasoning-ref":case"tool-call-ref":case"figmake-test-part":throw new s.T(`Not implemented: Conversion from pb MessagePart type ${c.type} to AnyPart not implemented`);default:(0,l.xb)(c)}}},501416:(e,t,r)=>{function s(){return new DOMException("Operation aborted by user.","AbortError")}function a(e){return e instanceof DOMException&&"AbortError"===e.name}r.d(t,{N:()=>s,z:()=>a})},379144:(e,t,r)=>{r.d(t,{A:()=>s});function s(e){if("function"==typeof AbortSignal.any)return AbortSignal.any(e);let t=new AbortController;for(let r of e)if(r&&r.aborted){try{t.abort(r.reason)}catch{t.abort()}return t.signal}let r={},s=new FinalizationRegistry(e=>void e()),a=new WeakRef(t),i=e=>{let t=e?.target,r=t&&"reason"in t?t.reason:void 0;try{a.deref()?.abort(r)}catch{a.deref()?.abort()}},n=e.map(e=>new WeakRef(e)),o=()=>{for(let e of n)e.deref()?.removeEventListener("abort",i);s.unregister(r)};for(let t of e)t.addEventListener("abort",i,{once:!0});return t.signal.addEventListener("abort",o,{once:!0}),s.register(t.signal,o,r),t.signal}}}]);

//# debugId=55607d9a-c14e-5ebb-bef3-6c06e3ff44a2

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/f2419b5f6dc66782c9f9abdf8f429d5d59446581/9816-c5e541adb2535357.min.js.map