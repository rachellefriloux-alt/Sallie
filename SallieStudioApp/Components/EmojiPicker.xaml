<UserControl
    x:Class="SallieStudioApp.Components.EmojiPicker"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SallieStudioApp.Components"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DesignHeight="600"
    d:DesignWidth="400">

    <UserControl.Resources>
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        
        <!-- Styles -->
        <Style x:Key="CategoryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border
                            Background="{TemplateBinding Background}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            CornerRadius="8"
                            Padding="{TemplateBinding Padding}">
                            <ContentPresenter
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="EmojiButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border
                            Background="{TemplateBinding Background}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            CornerRadius="4"
                            Padding="{TemplateBinding Padding}">
                            <ContentPresenter
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Animations -->
        <Storyboard x:Key="FadeIn">
            <DoubleAnimation
                Storyboard.TargetName="RootBorder"
                Storyboard.TargetProperty="Opacity"
                From="0"
                To="1"
                Duration="0:0:0.2"/>
            <DoubleAnimation
                Storyboard.TargetName="RootBorder"
                Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                From="50"
                To="0"
                Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <Storyboard x:Key="FadeOut">
            <DoubleAnimation
                Storyboard.TargetName="RootBorder"
                Storyboard.TargetProperty="Opacity"
                From="1"
                To="0"
                Duration="0:0:0.2"/>
            <DoubleAnimation
                Storyboard.TargetName="RootBorder"
                Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                From="0"
                To="50"
                Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </UserControl.Resources>

    <Border
        x:Name="RootBorder"
        Background="{ThemeResource AcrylicInAppSheetBackground}"
        BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
        BorderThickness="1"
        CornerRadius="12"
        Padding="20"
        RenderTransformOrigin="0.5,0.5"
        Opacity="0">
        <Border.RenderTransform>
            <TranslateTransform Y="50"/>
        </Border.RenderTransform>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button
                    Grid.Column="0"
                    Content="âœ•"
                    Style="{StaticResource CategoryButtonStyle}"
                    Click="CloseButton_Click"
                    ToolTipService.ToolTip="Close emoji picker"/>

                <TextBlock
                    Grid.Column="1"
                    Text="Emoji Picker"
                    Style="{StaticResource SubtitleTextBlockStyle}"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"/>

                <Button
                    Grid.Column="2"
                    Content="ðŸ”"
                    Style="{StaticResource CategoryButtonStyle}"
                    Click="SearchButton_Click"
                    ToolTipService.ToolTip="Search emojis"/>
            </Grid>

            <!-- Search Box -->
            <AutoSuggestBox
                x:Name="SearchBox"
                Grid.Row="1"
                PlaceholderText="Search emojis..."
                TextChanged="SearchBox_TextChanged"
                QuerySubmitted="SearchBox_QuerySubmitted"
                Margin="0,0,0,16"
                Visibility="{Binding IsSearchMode, Converter={StaticResource BoolToVisibilityConverter}}"/>

            <!-- Category Tabs -->
            <ScrollViewer
                Grid.Row="2"
                HorizontalScrollMode="Enabled"
                HorizontalScrollBarVisibility="Hidden"
                VerticalScrollMode="Disabled"
                Margin="0,0,0,16"
                Visibility="{Binding IsSearchMode, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Invert}">
                <StackPanel Orientation="Horizontal" x:Name="CategoryTabsPanel">
                    <!-- Categories will be added programmatically -->
                </StackPanel>
            </ScrollViewer>

            <!-- Recent Emojis -->
            <Grid
                Grid.Row="3"
                Margin="0,0,0,16"
                Visibility="{Binding ShowRecent, Converter={StaticResource BoolToVisibilityConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock
                    Grid.Row="0"
                    Text="Recently Used"
                    Style="{StaticResource CaptionTextBlockStyle}"
                    Margin="0,0,0,8"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

                <ScrollViewer
                    Grid.Row="1"
                    HorizontalScrollMode="Enabled"
                    HorizontalScrollBarVisibility="Hidden"
                    VerticalScrollMode="Disabled">
                    <ItemsControl x:Name="RecentEmojisPanel">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button
                                    Content="{Binding}"
                                    Style="{StaticResource EmojiButtonStyle}"
                                    Click="RecentEmoji_Click"
                                    Margin="0,0,4,0"
                                    ToolTipService.ToolTip="{Binding}"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>

            <!-- Emojis Grid -->
            <ScrollViewer
                Grid.Row="3"
                HorizontalScrollMode="Disabled"
                HorizontalScrollBarVisibility="Disabled"
                VerticalScrollMode="Auto"
                VerticalScrollBarVisibility="Auto">
                <GridView
                    x:Name="EmojisGrid"
                    ItemsSource="{Binding CurrentEmojis}"
                    SelectionMode="None"
                    Padding="0,0,0,0">
                    <GridView.ItemTemplate>
                        <DataTemplate>
                            <Button
                                Content="{Binding}"
                                Style="{StaticResource EmojiButtonStyle}"
                                Click="Emoji_Click"
                                Margin="2"
                                ToolTipService.ToolTip="{Binding}"/>
                        </DataTemplate>
                    </GridView.ItemTemplate>
                    <GridView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <VariableSizedWrapGrid
                                Orientation="Horizontal"
                                MaximumRowsOrColumns="8"/>
                        </ItemsPanelTemplate>
                    </GridView.ItemsPanel>
                </GridView>
            </ScrollViewer>

            <!-- Footer -->
            <Grid Grid.Row="4" Margin="0,16,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock
                    Grid.Column="0"
                    Text="{Binding EmojiCount, Converter={StaticResource EmojiCountConverter}}"
                    Style="{StaticResource CaptionTextBlockStyle}"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

                <Button
                    Grid.Column="1"
                    Content="Clear Recent"
                    Style="{StaticResource CategoryButtonStyle}"
                    Click="ClearRecent_Click"
                    Visibility="{Binding ShowRecent, Converter={StaticResource BoolToVisibilityConverter}}"
                    ToolTipService.ToolTip="Clear recently used emojis"/>
            </Grid>
        </Grid>
    </Border>
</UserControl>
