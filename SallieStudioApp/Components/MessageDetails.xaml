<UserControl
    x:Class="SallieStudioApp.Components.MessageDetails"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{StaticResource WindowBackground}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
                Background="{StaticResource PrimaryBrush}"
                Padding="20,16"
                CornerRadius="0,0,0,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0"
                        x:Name="CloseButton"
                        Content="âœ•"
                        Background="Transparent"
                        BorderThickness="0"
                        Padding="12"
                        FontSize="16"
                        Foreground="White"
                        Click="CloseButton_Click"/>

                <TextBlock Grid.Column="1"
                           Text="Message Details"
                           FontSize="18"
                           FontWeight="SemiBold"
                           Foreground="White"
                           HorizontalAlignment="Center"/>

                <Button Grid.Column="2"
                        x:Name="MoreButton"
                        Content="â‹¯"
                        Background="Transparent"
                        BorderThickness="0"
                        Padding="12"
                        FontSize="16"
                        Foreground="White"
                        Click="MoreButton_Click"/>
            </Grid>
        </Border>

        <!-- Content -->
        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      Padding="20,0,20,20">
            <StackPanel>
                <!-- Message Header -->
                <Border Background="{StaticResource CardBackground}"
                        CornerRadius="12"
                        Padding="16"
                        Margin="0,0,0,20">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="{Binding Message.SenderName}"
                                       FontSize="16"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimary}"/>
                            <TextBlock Text="{Binding Message.FormattedTimestamp}"
                                       FontSize="14"
                                       Foreground="{StaticResource TextSecondary}"/>
                        </StackPanel>

                        <Border Grid.Column="1"
                                Background="{Binding Message.PriorityColor}"
                                CornerRadius="8"
                                Padding="8,4"
                                Visibility="{Binding Message.HasPriority, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock Text="{Binding Message.Priority}"
                                       FontSize="10"
                                       FontWeight="SemiBold"
                                       Foreground="White"/>
                        </Border>
                    </Grid>
                </Border>

                <!-- Message Content -->
                <Border Background="{StaticResource CardBackground}"
                        CornerRadius="12"
                        Padding="16"
                        Margin="0,0,0,20">
                    <TextBlock Text="{Binding Message.Text}"
                               FontSize="16"
                               Foreground="{StaticResource TextPrimary}"
                               TextWrapping="Wrap"
                               LineHeight="24"/>
                </Border>

                <!-- Tabs -->
                <Border Background="{StaticResource CardBackground}"
                        CornerRadius="12"
                        Padding="4"
                        Margin="0,0,0,20">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0"
                                x:Name="DetailsTab"
                                Content="Details"
                                Background="{Binding SelectedTab, Converter={StaticResource TabBackgroundConverter}}"
                                Foreground="{Binding SelectedTab, Converter={StaticResource TabForegroundConverter}}"
                                BorderThickness="0"
                                Padding="12,8"
                                FontSize="14"
                                Click="DetailsTab_Click"
                                Tag="details"/>

                        <Button Grid.Column="1"
                                x:Name="RelatedTab"
                                Content="Related"
                                Background="{Binding SelectedTab, Converter={StaticResource TabBackgroundConverter}}"
                                Foreground="{Binding SelectedTab, Converter={StaticResource TabForegroundConverter}}"
                                BorderThickness="0"
                                Padding="12,8"
                                FontSize="14"
                                Click="RelatedTab_Click"
                                Tag="related"/>

                        <Button Grid.Column="2"
                                x:Name="ActionsTab"
                                Content="Actions"
                                Background="{Binding SelectedTab, Converter={StaticResource TabBackgroundConverter}}"
                                Foreground="{Binding SelectedTab, Converter={StaticResource TabForegroundConverter}}"
                                BorderThickness="0"
                                Padding="12,8"
                                FontSize="14"
                                Click="ActionsTab_Click"
                                Tag="actions"/>
                    </Grid>
                </Border>

                <!-- Tab Content -->
                <Grid x:Name="TabContent">
                    <!-- Details Tab -->
                    <StackPanel x:Name="DetailsPanel"
                                Visibility="Visible">
                        <!-- Metadata Section -->
                        <Border Background="{StaticResource CardBackground}"
                                CornerRadius="12"
                                Padding="16"
                                Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Message Metadata"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimary}"
                                           Margin="0,0,0,16"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0"
                                               Text="Category:"
                                               FontSize="14"
                                               FontWeight="500"
                                               Foreground="{StaticResource TextSecondary}"
                                               VerticalAlignment="Center"/>
                                    <Border Grid.Row="0" Grid.Column="1"
                                            Background="{Binding Message.CategoryColor}"
                                            CornerRadius="8"
                                            Padding="8,4"
                                            HorizontalAlignment="Left"
                                            Margin="0,0,0,12">
                                        <TextBlock Text="{Binding Message.Category}"
                                                   FontSize="12"
                                                   FontWeight="SemiBold"
                                                   Foreground="White"/>
                                    </Border>

                                    <TextBlock Grid.Row="1" Grid.Column="0"
                                               Text="Priority:"
                                               FontSize="14"
                                               FontWeight="500"
                                               Foreground="{StaticResource TextSecondary}"
                                               VerticalAlignment="Center"/>
                                    <Border Grid.Row="1" Grid.Column="1"
                                            Background="{Binding Message.PriorityColor}"
                                            CornerRadius="8"
                                            Padding="8,4"
                                            HorizontalAlignment="Left"
                                            Margin="0,0,0,12">
                                        <TextBlock Text="{Binding Message.Priority}"
                                                   FontSize="12"
                                                   FontWeight="SemiBold"
                                                   Foreground="White"/>
                                    </Border>

                                    <TextBlock Grid.Row="2" Grid.Column="0"
                                               Text="Sentiment:"
                                               FontSize="14"
                                               FontWeight="500"
                                               Foreground="{StaticResource TextSecondary}"
                                               VerticalAlignment="Center"/>
                                    <Border Grid.Row="2" Grid.Column="1"
                                            Background="{Binding Message.SentimentColor}"
                                            CornerRadius="8"
                                            Padding="8,4"
                                            HorizontalAlignment="Left"
                                            Margin="0,0,0,12">
                                        <TextBlock Text="{Binding Message.Sentiment}"
                                                   FontSize="12"
                                                   FontWeight="SemiBold"
                                                   Foreground="White"/>
                                    </Border>

                                    <TextBlock Grid.Row="3" Grid.Column="0"
                                               Text="Emotion:"
                                               FontSize="14"
                                               FontWeight="500"
                                               Foreground="{StaticResource TextSecondary}"
                                               VerticalAlignment="Center"/>
                                    <TextBlock Grid.Row="3" Grid.Column="1"
                                               Text="{Binding Message.Emotion}"
                                               FontSize="14"
                                               Foreground="{StaticResource TextPrimary}"
                                               Margin="0,0,0,12"/>

                                    <TextBlock Grid.Row="4" Grid.Column="0"
                                               Text="Context:"
                                               FontSize="14"
                                               FontWeight="500"
                                               Foreground="{StaticResource TextSecondary}"
                                               VerticalAlignment="Top"/>
                                    <TextBlock Grid.Row="4" Grid.Column="1"
                                               Text="{Binding Message.Context}"
                                               FontSize="14"
                                               Foreground="{StaticResource TextPrimary}"
                                               TextWrapping="Wrap"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Tags Section -->
                        <Border Background="{StaticResource CardBackground}"
                                CornerRadius="12"
                                Padding="16"
                                Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Tags"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimary}"
                                           Margin="0,0,0,16"/>

                                <ItemsControl ItemsSource="{Binding Message.Tags}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#e5e7eb"
                                                    CornerRadius="8"
                                                    Padding="8,4"
                                                    Margin="0,0,8,8">
                                                <TextBlock Text="{Binding}"
                                                           FontSize="12"
                                                           Foreground="{StaticResource TextSecondary}"/>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <ItemsControl ItemsSource="{Binding Message.Keywords}"
                                              Margin="0,8,0,0">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#fef3c7"
                                                    CornerRadius="8"
                                                    Padding="8,4"
                                                    Margin="0,0,8,8">
                                                <TextBlock Text="{Binding}"
                                                           FontSize="12"
                                                           Foreground="#92400e"/>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                        <!-- Attachments Section -->
                        <Border Background="{StaticResource CardBackground}"
                                CornerRadius="12"
                                Padding="16"
                                Visibility="{Binding Message.HasAttachments, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel>
                                <TextBlock Text="Attachments"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimary}"
                                           Margin="0,0,0,16"/>

                                <ItemsControl ItemsSource="{Binding Message.Attachments}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#f9fafb"
                                                    CornerRadius="8"
                                                    Padding="12"
                                                    Margin="0,0,0,8"
                                                    Cursor="Hand">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <Border Grid.Column="0"
                                                            Background="#f3f4f6"
                                                            CornerRadius="8"
                                                            Width="40"
                                                            Height="40"
                                                            Margin="0,0,12,0">
                                                        <TextBlock Text="{Binding TypeIcon}"
                                                                   FontSize="16"
                                                                   HorizontalAlignment="Center"
                                                                   VerticalAlignment="Center"/>
                                                    </Border>

                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="{Binding Name}"
                                                                   FontSize="14"
                                                                   FontWeight="500"
                                                                   Foreground="{StaticResource TextPrimary}"/>
                                                        <TextBlock Text="{Binding FormattedSize}"
                                                                   FontSize="12"
                                                                   Foreground="{StaticResource TextSecondary}"/>
                                                    </StackPanel>

                                                    <TextBlock Grid.Column="2"
                                                               Text="â†’"
                                                               FontSize="16"
                                                               Foreground="{StaticResource TextSecondary}"
                                                               VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Related Tab -->
                    <StackPanel x:Name="RelatedPanel"
                                Visibility="Collapsed">
                        <Border Background="{StaticResource CardBackground}"
                                CornerRadius="12"
                                Padding="16">
                            <StackPanel>
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="Related Messages"
                                               FontSize="18"
                                               FontWeight="SemiBold"
                                               Foreground="{StaticResource TextPrimary}"/>

                                    <Button Grid.Column="1"
                                            x:Name="ToggleRelatedButton"
                                            Content="{Binding RelatedMessagesToggleText}"
                                            Background="#f3f4f6"
                                            Foreground="{StaticResource TextSecondary}"
                                            BorderThickness="0"
                                            Padding="12,6"
                                            FontSize="12"
                                            Click="ToggleRelatedButton_Click"/>
                                </Grid>

                                <ItemsControl x:Name="RelatedMessagesList"
                                              ItemsSource="{Binding RelatedMessages}"
                                              Visibility="{Binding ShowRelatedMessages, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#f9fafb"
                                                    CornerRadius="8"
                                                    Padding="12"
                                                    Margin="0,0,0,8"
                                                    Cursor="Hand">
                                                <StackPanel>
                                                    <TextBlock Text="{Binding SenderName}"
                                                               FontSize="12"
                                                               FontWeight="600"
                                                               Foreground="{StaticResource PrimaryBrush}"
                                                               Margin="0,0,0,4"/>
                                                    <TextBlock Text="{Binding Text}"
                                                               FontSize="14"
                                                               Foreground="{StaticResource TextPrimary}"
                                                               TextWrapping="Wrap"
                                                               MaxLines="2"
                                                               Margin="0,0,0,4"/>
                                                    <TextBlock Text="{Binding FormattedTimestamp}"
                                                               FontSize="12"
                                                               Foreground="{StaticResource TextSecondary}"/>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Actions Tab -->
                    <StackPanel x:Name="ActionsPanel"
                                Visibility="Collapsed">
                        <Border Background="{StaticResource CardBackground}"
                                CornerRadius="12"
                                Padding="16">
                            <StackPanel>
                                <TextBlock Text="Actions"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimary}"
                                           Margin="0,0,0,16"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <Button Grid.Row="0" Grid.Column="0"
                                            Content="ðŸ“¤ Share"
                                            Background="#f9fafb"
                                            Foreground="{StaticResource TextPrimary}"
                                            BorderThickness="0"
                                            Padding="16,12"
                                            FontSize="14"
                                            Margin="0,0,8,8"
                                            Click="ShareButton_Click"/>

                                    <Button Grid.Row="0" Grid.Column="1"
                                            Content="ðŸ“‹ Copy"
                                            Background="#f9fafb"
                                            Foreground="{StaticResource TextPrimary}"
                                            BorderThickness="0"
                                            Padding="16,12"
                                            FontSize="14"
                                            Margin="8,0,0,8"
                                            Click="CopyButton_Click"/>

                                    <Button Grid.Row="1" Grid.Column="0"
                                            Content="ðŸ“š Bookmark"
                                            Background="#f9fafb"
                                            Foreground="{StaticResource TextPrimary}"
                                            BorderThickness="0"
                                            Padding="16,12"
                                            FontSize="14"
                                            Margin="0,0,8,8"
                                            Click="BookmarkButton_Click"/>

                                    <Button Grid.Row="1" Grid.Column="1"
                                            Content="ðŸ—‘ï¸ Delete"
                                            Background="#f9fafb"
                                            Foreground="{StaticResource TextPrimary}"
                                            BorderThickness="0"
                                            Padding="16,12"
                                            FontSize="14"
                                            Margin="8,0,0,8"
                                            Click="DeleteButton_Click"/>

                                    <Button Grid.Row="2" Grid.Column="0"
                                            Content="ðŸ“¤ Export"
                                            Background="#f9fafb"
                                            Foreground="{StaticResource TextPrimary}"
                                            BorderThickness="0"
                                            Padding="16,12"
                                            FontSize="14"
                                            Margin="0,0,8,8"
                                            Click="ExportButton_Click"/>

                                    <Button Grid.Row="2" Grid.Column="1"
                                            Content="ðŸš¨ Report"
                                            Background="#f9fafb"
                                            Foreground="{StaticResource TextPrimary}"
                                            BorderThickness="0"
                                            Padding="16,12"
                                            FontSize="14"
                                            Margin="8,0,0,8"
                                            Click="ReportButton_Click"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
