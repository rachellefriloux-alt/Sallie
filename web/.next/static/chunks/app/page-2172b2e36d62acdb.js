(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3909:function(e,t,a){Promise.resolve().then(a.bind(a,8080))},8080:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return O}});var s=a(7437),r=a(2265),n=a(9376),l=a(7648),i=a(2177);function c(e){let{isConnected:t}=e;return(0,s.jsxs)("div",{className:"text-center py-5",role:"region","aria-label":"Sallie avatar",children:[(0,s.jsx)("div",{className:"w-36 h-36 mx-auto mb-4 rounded-full bg-gradient-to-br from-primary to-accent p-1    shadow-lg shadow-primary/40 animate-pulse",children:(0,s.jsx)("div",{className:"w-full h-full rounded-full bg-gray-900 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-5xl font-semibold bg-gradient-to-br from-primary to-accent bg-clip-text text-transparent",children:"S"})})}),(0,s.jsx)("h2",{className:"text-2xl font-semibold mb-2 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"Sallie"}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-400",children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full ".concat(t?"bg-success animate-pulse":"bg-error"),"aria-label":t?"Online":"Offline"}),(0,s.jsx)("span",{children:t?"Online":"Connecting..."})]})]})}function o(e){let{limbicState:t,isConnected:a}=e,r=(0,n.usePathname)();return(0,s.jsxs)("aside",{className:"w-80 bg-gray-800/70 backdrop-blur-xl border-r border-gray-700 p-6 flex flex-col gap-6",role:"complementary","aria-label":"Sallie status and navigation",children:[(0,s.jsx)(c,{isConnected:a}),(0,s.jsx)("nav",{"aria-label":"Main navigation",children:(0,s.jsx)("ul",{className:"space-y-1",children:[{href:"/",label:"Chat",icon:"\uD83D\uDCAC"},{href:"/limbic",label:"Limbic State",icon:"\uD83E\uDDE0"},{href:"/heritage",label:"Heritage",icon:"\uD83D\uDCDC"},{href:"/thoughts",label:"Thoughts Log",icon:"\uD83D\uDCAD"},{href:"/hypotheses",label:"Hypotheses",icon:"\uD83D\uDD2C"},{href:"/projects",label:"Projects",icon:"\uD83D\uDEE0️"},{href:"/convergence",label:"Convergence",icon:"\uD83C\uDF00"},{href:"/control",label:"Control Panel",icon:"\uD83C\uDF9B️"},{href:"/settings",label:"Settings",icon:"⚙️"}].map(e=>{let t=r===e.href;return(0,s.jsx)("li",{children:(0,s.jsxs)(l.default,{href:e.href,className:"flex items-center gap-3 px-4 py-2 rounded-lg transition-colors ".concat(t?"bg-violet-600/20 text-violet-400 border border-violet-500/30":"text-gray-400 hover:text-gray-200 hover:bg-gray-700/50"),"aria-current":t?"page":void 0,children:[(0,s.jsx)("span",{children:e.icon}),(0,s.jsx)("span",{children:e.label})]})},e.href)})})}),(0,s.jsx)(i.O,{state:t})]})}function d(e){let{messages:t,onReaction:a,onBookmark:n,searchQuery:l=""}=e,[i,c]=(0,r.useState)(null),o=l?t.filter(e=>e.text.toLowerCase().includes(l.toLowerCase())):t;if(0===t.length)return(0,s.jsx)("div",{className:"flex items-center justify-center h-full text-gray-500",children:(0,s.jsx)("p",{children:"Start a conversation with Sallie..."})});if(0===o.length&&l)return(0,s.jsx)("div",{className:"flex items-center justify-center h-full text-gray-500",children:(0,s.jsxs)("p",{children:['No messages found matching "',l,'"']})});let d=e=>{let t=new Date(e),a=new Date().getTime()-t.getTime(),s=Math.floor(a/6e4),r=Math.floor(a/36e5),n=Math.floor(a/864e5);return s<1?"Just now":s<60?"".concat(s,"m ago"):r<24?"".concat(r,"h ago"):n<7?"".concat(n,"d ago"):t.toLocaleDateString()},x=e=>{switch(e){case"sending":return"⏳";case"sent":return"✓";case"delivered":case"read":return"✓✓";case"error":return"⚠️";default:return null}};return(0,s.jsx)("div",{className:"space-y-4",role:"log","aria-live":"polite","aria-label":"Chat messages",children:o.map(e=>{e.id;let t=l&&e.text.toLowerCase().includes(l.toLowerCase());return(0,s.jsx)("div",{className:"flex ".concat("user"===e.sender?"justify-end":"justify-start"," group"),role:"article","aria-label":"Message from ".concat("user"===e.sender?"you":"Sallie"),children:(0,s.jsxs)("div",{className:"max-w-[80%] rounded-2xl px-4 py-3 relative ".concat("user"===e.sender?"bg-gradient-to-br from-violet-600 to-violet-700 text-white":"system"===e.sender?"bg-transparent text-gray-500 text-sm text-center":"bg-gray-800 text-gray-100 border border-gray-700"," ").concat(t?"ring-2 ring-violet-500":""),children:["ai"===e.sender&&(0,s.jsxs)("div",{className:"text-xs text-gray-400 mb-1 font-medium flex items-center justify-between",children:[(0,s.jsx)("span",{children:"Sallie"}),e.status&&(0,s.jsx)("span",{className:"ml-2",title:e.status,children:x(e.status)})]}),(0,s.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words",children:e.text}),e.reactions&&e.reactions.length>0&&(0,s.jsx)("div",{className:"flex gap-1 mt-2 flex-wrap",children:e.reactions.map((t,r)=>(0,s.jsx)("span",{className:"text-xs bg-gray-700 px-2 py-1 rounded-full",role:"button",tabIndex:0,onClick:()=>null==a?void 0:a(e.id,t),onKeyDown:s=>{("Enter"===s.key||" "===s.key)&&(null==a||a(e.id,t))},children:t},r))}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,s.jsx)("time",{className:"text-xs text-gray-500",dateTime:new Date(e.timestamp).toISOString(),title:new Date(e.timestamp).toLocaleString(),children:d(e.timestamp)}),(0,s.jsxs)("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:["ai"===e.sender&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>null==a?void 0:a(e.id,"\uD83D\uDC4D"),className:"text-xs text-gray-400 hover:text-gray-300","aria-label":"Add reaction",title:"Add reaction",children:"\uD83D\uDC4D"}),(0,s.jsx)("button",{onClick:()=>null==n?void 0:n(e.id),className:"text-xs ".concat(e.bookmarked?"text-yellow-400":"text-gray-400 hover:text-gray-300"),"aria-label":e.bookmarked?"Remove bookmark":"Bookmark message",title:e.bookmarked?"Bookmarked":"Bookmark",children:e.bookmarked?"\uD83D\uDD16":"\uD83D\uDCCC"})]}),"user"===e.sender&&e.status&&(0,s.jsx)("span",{className:"text-xs text-gray-500",title:e.status,children:x(e.status)})]})]})]})},e.id)})})}function x(e){let{onSend:t,disabled:a}=e,[n,l]=(0,r.useState)(""),i=()=>{n.trim()&&!a&&(t(n.trim()),l(""))};return(0,s.jsxs)("div",{className:"flex gap-3 items-end",children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)("label",{htmlFor:"chat-input",className:"sr-only",children:"Type your message"}),(0,s.jsx)("textarea",{id:"chat-input",value:n,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),i())},placeholder:a?"Connecting...":"Message Sallie...",disabled:a,rows:1,className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl    text-gray-100 placeholder-gray-500 resize-none   focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent   disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Chat input","aria-describedby":"input-help"}),(0,s.jsx)("span",{id:"input-help",className:"sr-only",children:"Press Enter to send, Shift+Enter for new line"})]}),(0,s.jsx)("button",{onClick:i,disabled:a||!n.trim(),className:"px-6 py-3 bg-gradient-to-br from-primary to-primary-dark    text-white rounded-xl font-medium   hover:from-primary-dark hover:to-primary   focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-gray-900   disabled:opacity-50 disabled:cursor-not-allowed   transition-all duration-200","aria-label":"Send message",children:"Send"})]})}function m(e){let{messages:t,onSend:a,isConnected:n,isTyping:l=!1}=e,i=(0,r.useRef)(null),[c,o]=(0,r.useState)(""),[m,u]=(0,r.useState)(!1),[g,h]=(0,r.useState)(new Set);(0,r.useEffect)(()=>{var e;null===(e=i.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t,l]);let p=(0,r.useMemo)(()=>t.map(e=>({...e,bookmarked:g.has(e.id)})),[t,g]);return(0,s.jsxs)("div",{className:"flex-1 flex flex-col bg-gray-900",children:[(0,s.jsxs)("header",{className:"px-6 py-4 border-b border-gray-800 flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-lg font-semibold",children:"Conversation"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>u(!m),className:"p-2 text-gray-400 hover:text-gray-300 rounded-lg hover:bg-gray-800","aria-label":"Search messages",title:"Search messages",children:"\uD83D\uDD0D"}),(0,s.jsx)("button",{onClick:()=>{let e=new Blob([JSON.stringify(t.map(e=>({timestamp:new Date(e.timestamp).toISOString(),sender:e.sender,text:e.text})),null,2)],{type:"application/json"}),a=URL.createObjectURL(e),s=document.createElement("a");s.href=a,s.download="sallie-conversation-".concat(new Date().toISOString().split("T")[0],".json"),s.click(),URL.revokeObjectURL(a)},className:"p-2 text-gray-400 hover:text-gray-300 rounded-lg hover:bg-gray-800","aria-label":"Export conversation",title:"Export conversation",children:"\uD83D\uDCE5"}),(0,s.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(n?"bg-emerald-500/20 text-emerald-400":"bg-red-500/20 text-red-400"),"aria-live":"polite","aria-atomic":"true",children:n?"Connected":"Disconnected"})]})]}),m&&(0,s.jsx)("div",{className:"px-6 py-2 border-b border-gray-800 bg-gray-800/50",children:(0,s.jsx)("input",{type:"text",value:c,onChange:e=>o(e.target.value),placeholder:"Search messages...",className:"w-full px-4 py-2 bg-gray-700 text-gray-100 rounded-lg border border-gray-600 focus:border-violet-500 focus:ring-2 focus:ring-violet-500 focus:outline-none","aria-label":"Search messages"})}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-4",role:"log","aria-live":"polite","aria-label":"Chat messages",children:[(0,s.jsx)(d,{messages:p,onReaction:(e,t)=>{console.log("Reaction:",e,t)},onBookmark:e=>{h(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},searchQuery:c}),l&&(0,s.jsx)("div",{className:"flex justify-start mt-4",children:(0,s.jsx)("div",{className:"bg-gray-800 rounded-2xl px-4 py-3 border border-gray-700",children:(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),(0,s.jsx)("div",{ref:i})]}),(0,s.jsx)("div",{className:"border-t border-gray-800 p-4",children:(0,s.jsx)(x,{onSend:a,disabled:!n})})]})}var u=a(1442),g=a(7842),h=a(301);let p=a(257).env.NEXT_PUBLIC_API_URL||"http://localhost:8000";function y(){let[e,t]=(0,r.useState)({backend:"checking",ollama:"checking",qdrant:"checking"}),[a,n]=(0,r.useState)(!1),[l,i]=(0,r.useState)(new Date),c=async()=>{let e={backend:"checking",ollama:"checking",qdrant:"checking"};try{let t=await fetch("".concat(p,"/health"),{signal:AbortSignal.timeout(5e3)});if(t.ok){var a,s;let r=await t.json();e.backend="connected",(null===(a=r.services)||void 0===a?void 0:a.ollama)==="healthy"?e.ollama="connected":e.ollama="disconnected",(null===(s=r.services)||void 0===s?void 0:s.qdrant)==="healthy"?e.qdrant="connected":e.qdrant="disconnected"}else e.backend="disconnected",e.ollama="disconnected",e.qdrant="disconnected"}catch(t){e.backend="disconnected",e.ollama="disconnected",e.qdrant="disconnected"}t(e),i(new Date)};(0,r.useEffect)(()=>{c();let e=setInterval(c,3e4);return()=>clearInterval(e)},[]);let o="connected"===e.backend&&"connected"===e.ollama&&"connected"===e.qdrant?"good":"connected"===e.backend?"degraded":"down",d=e=>{switch(e){case"connected":return(0,s.jsx)(u.Z,{className:"w-4 h-4 text-green-500"});case"disconnected":return(0,s.jsx)(h.Z,{className:"w-4 h-4 text-red-500"});case"checking":return(0,s.jsx)("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"})}};return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>n(!a),className:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-gray-800 hover:bg-gray-700 transition-colors",title:"Service Status",children:[(0,s.jsx)(()=>{switch(o){case"good":return(0,s.jsx)(u.Z,{className:"w-5 h-5 text-green-500"});case"degraded":return(0,s.jsx)(g.Z,{className:"w-5 h-5 text-yellow-500"});case"down":return(0,s.jsx)(h.Z,{className:"w-5 h-5 text-red-500"})}},{}),(0,s.jsx)("span",{className:"text-sm hidden md:inline",children:(0,s.jsx)(()=>{switch(o){case"good":return(0,s.jsx)("span",{className:"text-green-500",children:"All Systems Operational"});case"degraded":return(0,s.jsx)("span",{className:"text-yellow-500",children:"Some Services Unavailable"});case"down":return(0,s.jsx)("span",{className:"text-red-500",children:"Backend Disconnected"})}},{})})]}),a&&(0,s.jsx)("div",{className:"absolute right-0 mt-2 w-72 bg-gray-800 rounded-lg shadow-lg border border-gray-700 p-4 z-50",children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between pb-2 border-b border-gray-700",children:[(0,s.jsx)("h3",{className:"font-semibold text-white",children:"Service Status"}),(0,s.jsx)("button",{onClick:()=>c(),className:"text-xs text-violet-400 hover:text-violet-300",children:"Refresh"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-300",children:"Backend API"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[d(e.backend),(0,s.jsx)("span",{className:"text-xs text-gray-400 capitalize",children:e.backend})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-300",children:"Ollama (AI)"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[d(e.ollama),(0,s.jsx)("span",{className:"text-xs text-gray-400 capitalize",children:e.ollama})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-300",children:"Qdrant (Memory)"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[d(e.qdrant),(0,s.jsx)("span",{className:"text-xs text-gray-400 capitalize",children:e.qdrant})]})]})]}),(0,s.jsx)("div",{className:"pt-2 border-t border-gray-700",children:(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Last checked: ",l.toLocaleTimeString()]})}),"down"===o&&(0,s.jsxs)("div",{className:"pt-2 border-t border-gray-700",children:[(0,s.jsx)("p",{className:"text-xs text-gray-300 mb-2",children:"Troubleshooting:"}),(0,s.jsxs)("ul",{className:"text-xs text-gray-400 space-y-1 list-disc list-inside",children:[(0,s.jsx)("li",{children:"Check if backend is running"}),(0,s.jsx)("li",{children:"Verify Docker services are started"}),(0,s.jsxs)("li",{children:["Run: ",(0,s.jsx)("code",{className:"bg-gray-900 px-1",children:"./start-sallie.sh"})]})]})]}),"degraded"===o&&(0,s.jsxs)("div",{className:"pt-2 border-t border-gray-700",children:[(0,s.jsx)("p",{className:"text-xs text-gray-300 mb-2",children:"Note:"}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Some features may be limited. Check that Docker services are running."})]})]})})]})}var b=a(6687),f=a(7165);let v=[{keys:["Ctrl","K"],description:"Focus chat input",category:"Navigation"},{keys:["Ctrl","B"],description:"Toggle sidebar",category:"Navigation"},{keys:["Ctrl","L"],description:"Open limbic view",category:"Navigation"},{keys:["Ctrl","H"],description:"Open heritage browser",category:"Navigation"},{keys:["Ctrl",","],description:"Open settings",category:"Navigation"},{keys:["Enter"],description:"Send message",category:"Chat"},{keys:["Shift","Enter"],description:"New line",category:"Chat"},{keys:["Ctrl","U"],description:"Clear input",category:"Chat"},{keys:["↑"],description:"Edit last message",category:"Chat"},{keys:["Ctrl","N"],description:"New conversation",category:"Actions"},{keys:["Ctrl","S"],description:"Save conversation",category:"Actions"},{keys:["Ctrl","/"],description:"Toggle this help",category:"Actions"},{keys:["Esc"],description:"Close dialogs",category:"Actions"}];function j(){let[e,t]=(0,r.useState)(!1);if((0,r.useEffect)(()=>{let a=a=>{(a.ctrlKey||a.metaKey)&&"/"===a.key&&(a.preventDefault(),t(e=>!e)),"Escape"===a.key&&e&&t(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[e]),!e)return(0,s.jsx)("button",{onClick:()=>t(!0),className:"fixed bottom-4 right-4 p-3 bg-gray-800 hover:bg-gray-700 rounded-full shadow-lg border border-gray-700 transition-colors z-40",title:"Keyboard Shortcuts (Ctrl+/)",children:(0,s.jsx)(b.Z,{className:"w-6 h-6 text-gray-300"})});let a=Array.from(new Set(v.map(e=>e.category)));return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-2xl border border-gray-700 max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(b.Z,{className:"w-6 h-6 text-violet-400"}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Keyboard Shortcuts"})]}),(0,s.jsx)("button",{onClick:()=>t(!1),className:"text-gray-400 hover:text-white transition-colors",children:(0,s.jsx)(f.Z,{className:"w-6 h-6"})})]}),(0,s.jsx)("div",{className:"p-6 overflow-y-auto flex-1",children:a.map(e=>(0,s.jsxs)("div",{className:"mb-6 last:mb-0",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-3",children:e}),(0,s.jsx)("div",{className:"space-y-2",children:v.filter(t=>t.category===e).map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg hover:bg-gray-700/50 transition-colors",children:[(0,s.jsx)("span",{className:"text-gray-300",children:e.description}),(0,s.jsx)("div",{className:"flex items-center space-x-1",children:e.keys.map((t,a)=>(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)("kbd",{className:"px-2 py-1 text-xs font-semibold text-gray-300 bg-gray-900 border border-gray-700 rounded",children:t}),a<e.keys.length-1&&(0,s.jsx)("span",{className:"text-gray-500 mx-1",children:"+"})]},a))})]},t))})]},e))}),(0,s.jsx)("div",{className:"p-4 border-t border-gray-700 bg-gray-900/50",children:(0,s.jsxs)("p",{className:"text-xs text-gray-400 text-center",children:["Press ",(0,s.jsx)("kbd",{className:"px-2 py-1 text-xs font-semibold text-gray-300 bg-gray-800 border border-gray-700 rounded",children:"Ctrl"})," + ",(0,s.jsx)("kbd",{className:"px-2 py-1 text-xs font-semibold text-gray-300 bg-gray-800 border border-gray-700 rounded",children:"/"})," "," to toggle this panel"]})})]})})}var N=a(3192),k=a(6350);let w=[{key:"k",ctrl:!0,action:()=>{let e=document.querySelector("#chat-input");null==e||e.focus()},description:"Focus chat input"},{key:"/",action:()=>{let e=document.querySelector('input[type="text"][placeholder*="Search"]');null==e||e.focus()},description:"Focus search"},{key:"Escape",action:()=>{let e=document.querySelector('input[type="text"][placeholder*="Search"]');e&&(e.value="",e.blur())},description:"Close/clear"}];function S(){let[e,t]=(0,r.useState)([]),[a,n]=(0,r.useState)(!1),[l,i]=(0,r.useState)(null),{connect:c,send:d,isConnected:x}=(0,N.s)(),{state:u,updateState:g}=(0,k.q)();(0,r.useEffect)(()=>{let e=e=>{for(let t of w){let a=t.ctrl?e.ctrlKey||e.metaKey:!e.ctrlKey&&!e.metaKey,s=t.shift?e.shiftKey:!e.shiftKey,r=t.alt?e.altKey:!e.altKey,n=e.key.toLowerCase()===t.key.toLowerCase();if(a&&s&&r&&n){e.preventDefault(),t.action();break}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[w]),(0,r.useEffect)(()=>{c(e=>{if("typing"===e.type)n("thinking"===e.status);else if("response_chunk"===e.type){if(l)t(t=>t.map(t=>t.id===l?{...t,text:t.text+e.content}:t));else{let t=Date.now().toString();i(t),h(e.content,"ai",t,"sent")}e.is_complete&&(i(null),n(!1))}else"response"===e.type?(n(!1),i(null),h(e.content,"ai",void 0,"sent")):"limbic_update"===e.type?g(e.state):"ghost_tap"===e.type&&h(e.content,"system")})},[l]);let h=(e,a,s,r)=>{let n=s||Date.now().toString();return t(t=>[...t,{id:n,text:e,sender:a,timestamp:Date.now(),status:r||("user"===a?"sent":void 0)}]),n};return(0,s.jsxs)("div",{className:"flex h-screen bg-gray-900 text-gray-100",children:[(0,s.jsx)("a",{href:"#main-content",className:"skip-link",children:"Skip to main content"}),(0,s.jsx)(o,{limbicState:u,isConnected:x}),(0,s.jsxs)("main",{id:"main-content",className:"flex-1 flex flex-col",role:"main",children:[(0,s.jsx)("div",{className:"flex items-center justify-end p-4 border-b border-gray-800",children:(0,s.jsx)(y,{})}),(0,s.jsx)(m,{messages:e,onSend:e=>{if(!e.trim()||!x)return;let a=h(e,"user",void 0,"sending");d(JSON.stringify({type:"chat",content:e})),setTimeout(()=>{t(e=>e.map(e=>e.id===a?{...e,status:"sent"}:e))},100)},isConnected:x,isTyping:a})]}),(0,s.jsx)(j,{})]})}var C=a(9812);let D=a(257).env.NEXT_PUBLIC_API_URL||"http://localhost:8000";function E(e){let{onComplete:t}=e,[a,n]=(0,r.useState)(0),[l,i]=(0,r.useState)([{id:"backend",title:"Backend Connection",description:"Verifying connection to Sallie backend...",status:"pending"},{id:"ollama",title:"AI Models",description:"Checking Ollama and AI models...",status:"pending"},{id:"qdrant",title:"Memory System",description:"Verifying Qdrant vector database...",status:"pending"},{id:"convergence",title:"Great Convergence",description:"Setting up your personal heritage...",status:"pending"}]),[c,o]=(0,r.useState)("checking");(0,r.useEffect)(()=>{x()},[]);let d=(e,t,a)=>{i(s=>s.map(s=>s.id===e?{...s,status:t,errorMessage:a}:s))},x=async()=>{d("backend","checking");try{let a=await fetch("".concat(D,"/health"),{signal:AbortSignal.timeout(1e4)});if(a.ok){var e,t;let s=await a.json();d("backend","complete"),d("ollama","checking"),(null===(e=s.services)||void 0===e?void 0:e.ollama)==="healthy"?d("ollama","complete"):d("ollama","error","Ollama not responding. AI features will be limited."),d("qdrant","checking"),(null===(t=s.services)||void 0===t?void 0:t.qdrant)==="healthy"?d("qdrant","complete"):d("qdrant","error","Qdrant not responding. Memory features will be limited."),d("convergence","checking");try{let e=await fetch("".concat(D,"/convergence/status"));e.ok&&(await e.json()).completed?d("convergence","complete"):d("convergence","pending"),o("ready")}catch(e){d("convergence","pending"),o("ready")}}else d("backend","error","Backend not responding"),d("ollama","error","Cannot check - backend down"),d("qdrant","error","Cannot check - backend down"),d("convergence","error","Cannot check - backend down"),o("error")}catch(e){d("backend","error","Connection failed. Is the backend running?"),d("ollama","error","Cannot check - backend down"),d("qdrant","error","Cannot check - backend down"),d("convergence","error","Cannot check - backend down"),o("error")}},m=e=>{switch(e){case"complete":return(0,s.jsx)(u.Z,{className:"w-6 h-6 text-green-500"});case"error":return(0,s.jsx)(h.Z,{className:"w-6 h-6 text-red-500"});case"checking":return(0,s.jsx)("div",{className:"w-6 h-6 border-2 border-violet-500 border-t-transparent rounded-full animate-spin"});case"pending":return(0,s.jsx)("div",{className:"w-6 h-6 border-2 border-gray-600 rounded-full"})}};return(0,s.jsx)("div",{className:"fixed inset-0 bg-gradient-to-b from-gray-900 via-gray-900 to-violet-900 flex items-center justify-center z-50",children:(0,s.jsx)("div",{className:"max-w-2xl w-full mx-4",children:(0,s.jsxs)("div",{className:"bg-gray-800 rounded-2xl shadow-2xl p-8 border border-gray-700",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDF1F"}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"Welcome to Sallie"}),(0,s.jsx)("p",{className:"text-gray-400",children:"Setting up your AI cognitive partner..."})]}),(0,s.jsx)("div",{className:"space-y-4 mb-8",children:l.map((e,t)=>(0,s.jsx)("div",{className:"p-4 rounded-lg border transition-all ".concat("complete"===e.status?"bg-green-900/20 border-green-700":"error"===e.status?"bg-red-900/20 border-red-700":"checking"===e.status?"bg-violet-900/20 border-violet-700":"bg-gray-700/50 border-gray-600"),children:(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mt-1",children:m(e.status)}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"font-semibold text-white",children:e.title}),(0,s.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:e.description}),e.errorMessage&&(0,s.jsxs)("p",{className:"text-sm text-red-400 mt-2",children:["⚠️ ",e.errorMessage]})]})]})},e.id))}),(0,s.jsxs)("div",{className:"text-center mb-6",children:["checking"===c&&(0,s.jsx)("p",{className:"text-gray-400 animate-pulse",children:"Running system checks..."}),"ready"===c&&(0,s.jsx)("p",{className:"text-green-400",children:"✓ System ready! You can now continue."}),"error"===c&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-red-400",children:"⚠️ Connection failed. Please check your setup."}),(0,s.jsxs)("div",{className:"text-left bg-gray-900 rounded-lg p-4 text-sm",children:[(0,s.jsx)("p",{className:"text-gray-300 font-semibold mb-2",children:"Quick Fix:"}),(0,s.jsxs)("ol",{className:"list-decimal list-inside space-y-1 text-gray-400",children:[(0,s.jsx)("li",{children:"Make sure Docker Desktop is running"}),(0,s.jsx)("li",{children:"Open terminal in Sallie directory"}),(0,s.jsxs)("li",{children:["Run: ",(0,s.jsx)("code",{className:"bg-gray-800 px-2 py-1 rounded text-violet-400",children:"./start-sallie.sh"})]}),(0,s.jsx)("li",{children:"Wait for services to start (30-60 seconds)"}),(0,s.jsx)("li",{children:"Refresh this page"})]})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("button",{onClick:x,className:"px-4 py-2 text-sm text-violet-400 hover:text-violet-300 transition-colors",disabled:"checking"===c,children:"↻ Retry Checks"}),(0,s.jsxs)("button",{onClick:()=>{if("ready"===c){let e=l.find(e=>"convergence"===e.id);(null==e?void 0:e.status)==="pending"?window.location.href="/convergence":t()}},disabled:"ready"!==c,className:"px-6 py-3 rounded-lg font-semibold flex items-center space-x-2 transition-all ".concat("ready"===c?"bg-violet-600 hover:bg-violet-700 text-white cursor-pointer":"bg-gray-700 text-gray-500 cursor-not-allowed"),children:[(0,s.jsx)("span",{children:"Continue"}),(0,s.jsx)(C.Z,{className:"w-4 h-4"})]})]}),(0,s.jsx)("div",{className:"mt-4 text-center",children:(0,s.jsx)("button",{onClick:t,className:"text-xs text-gray-500 hover:text-gray-400 transition-colors",children:"Skip setup wizard (not recommended)"})})]})})})}let L=a(257).env.NEXT_PUBLIC_API_URL||"http://localhost:8000";function O(){let e=(0,n.useRouter)(),[t,a]=(0,r.useState)(!0),[l,i]=(0,r.useState)(!1),[c,o]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{let t=!0,s=localStorage.getItem("sallie_first_run_completed");return(async()=>{try{let r=new AbortController,n=setTimeout(()=>r.abort(),5e3),l=await fetch("".concat(L,"/convergence/status"),{signal:r.signal});if(clearTimeout(n),!t)return;if(l.ok&&!(await l.json()).completed){i(!0),e.push("/convergence");return}s||o(!0),a(!1)}catch(e){console.warn("Backend connection check failed:",e instanceof Error?e.message:String(e)),t&&(s||o(!0),a(!1))}})(),()=>{t=!1}},[]),t||l)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-900",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-violet-400 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-400",children:l?"Redirecting to setup...":"Loading Sallie..."})]})}):c?(0,s.jsx)(E,{onComplete:()=>{localStorage.setItem("sallie_first_run_completed","true"),o(!1)}}):(0,s.jsx)(S,{})}},2177:function(e,t,a){"use strict";a.d(t,{O:function(){return r}});var s=a(7437);function r(e){let{state:t}=e,a=[{label:"Trust",value:t.trust,color:"from-primary to-accent",ariaLabel:"Trust level: ".concat((100*t.trust).toFixed(0),"%")},{label:"Warmth",value:t.warmth,color:"from-accent to-warning",ariaLabel:"Warmth level: ".concat((100*t.warmth).toFixed(0),"%")},{label:"Energy",value:t.arousal,color:"from-warning to-error",ariaLabel:"Energy level: ".concat((100*t.arousal).toFixed(0),"%")},{label:"Mood",value:(t.valence+1)/2,color:"from-info to-success",ariaLabel:"Mood level: ".concat((100*t.valence).toFixed(0),"%")}];return(0,s.jsxs)("div",{role:"region","aria-label":"Emotional state gauges",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-400 uppercase tracking-wider mb-4",children:"Emotional State"}),(0,s.jsx)("div",{className:"space-y-4",children:a.map(e=>(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-sm text-gray-300",children:e.label}),(0,s.jsx)("span",{className:"text-xs text-gray-500 font-mono",children:e.value.toFixed(2)})]}),(0,s.jsx)("div",{className:"h-1.5 bg-gray-700 rounded-full overflow-hidden",role:"progressbar","aria-valuenow":100*e.value,"aria-valuemin":0,"aria-valuemax":100,"aria-label":e.ariaLabel,children:(0,s.jsx)("div",{className:"h-full bg-gradient-to-r ".concat(e.color," transition-all duration-500"),style:{width:"".concat(100*e.value,"%")}})})]},e.label))}),(0,s.jsxs)("div",{className:"mt-6 p-3 bg-gray-700/50 rounded-lg text-center",children:[(0,s.jsx)("div",{className:"text-xs text-gray-400 uppercase tracking-wider mb-1",children:"Current Mode"}),(0,s.jsx)("div",{className:"text-lg font-semibold text-accent-light",children:t.posture||"PEER"})]})]})}},3192:function(e,t,a){"use strict";a.d(t,{s:function(){return r}});var s=a(2265);function r(){let[e,t]=(0,s.useState)(!1),a=(0,s.useRef)(null),r=(0,s.useRef)(null),n=(0,s.useCallback)(e=>{var s;if((null===(s=a.current)||void 0===s?void 0:s.readyState)===WebSocket.OPEN)return;let l=new WebSocket("ws://localhost:8000/ws");r.current=e,l.onopen=()=>{t(!0)},l.onclose=()=>{t(!1),setTimeout(()=>n(e),3e3)},l.onerror=e=>{console.error("WebSocket error:",e),t(!1)},l.onmessage=e=>{try{var t;let a=JSON.parse(e.data);null===(t=r.current)||void 0===t||t.call(r,a)}catch(e){console.error("Failed to parse WebSocket message:",e)}},a.current=l},[]),l=(0,s.useCallback)(e=>{var t;(null===(t=a.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN&&a.current.send(e)},[]);return(0,s.useEffect)(()=>()=>{var e;null===(e=a.current)||void 0===e||e.close()},[]),{connect:n,send:l,isConnected:e}}},6350:function(e,t,a){"use strict";a.d(t,{q:function(){return n}});var s=a(9625);let r={trust:.5,warmth:.6,arousal:.7,valence:.6,posture:"PEER"},n=(0,s.Ue)(e=>({state:r,updateState:t=>e(e=>({state:{...e.state,...t}}))}))}},function(e){e.O(0,[835,971,117,744],function(){return e(e.s=3909)}),_N_E=e.O()}]);